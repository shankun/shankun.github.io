<!doctype html><html lang=zh_CN><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content="light dark" name=color-scheme><title>å‡½æ•°å¼ç¼–ç¨‹æŒ‡å—ä¸­æ–‡ç‰ˆç¬¬9ç« </title><link href=https://shankun.github.io/img/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=https://shankun.github.io/img/favicon-16x16.png rel=icon sizes=16x16 type=image/png><link href=https://shankun.github.io/img/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><style>body{--primary-color:#5871a2;--primary-pale-color:#5871a210;--text-color:#3c4043;--text-pale-color:#94969f;--bg-color:#fff;--highlight-mark-color:#5f75b035;--callout-note-color:#5871a2;--callout-important-color:#8062b0;--callout-warning-color:#936e51;--callout-alert-color:#bc5252;--callout-question-color:#477389;--callout-tip-color:#3c8460;--main-font:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";--code-font:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;--homepage-max-width:768px;--main-max-width:768px;--avatar-size:60px;--icon-size:20px;--homepage-font-size:16px;--homepage-line-height:1.75;--paragraph-font-size:16px;--paragraph-line-height:1.75;--aside-font-size:15px;--img-border-radius:0;--callout-border-radius:0;--detail-border-radius:0;--dark-mode-img-brightness:.75;--dark-mode-chart-brightness:.75;--inline-code-border-radius:2px;--inline-code-bg-color:var(--primary-pale-color);--block-code-border-radius:0;--block-code-border-color:var(--primary-color);--detail-border-color:var(--primary-color);--homepage-bg-image:url(https://shankun.github.io/img/greenBamboo.jpg)}body.dark{--primary-color:#5d77ac;--primary-pale-color:#5d77ac20;--text-color:#9197a5;--text-pale-color:#747983;--bg-color:#202124;--highlight-mark-color:#5f75b035;--callout-note-color:#5d77ac;--callout-important-color:#8062b0;--callout-warning-color:#936e51;--callout-alert-color:#bc5252;--callout-question-color:#477389;--callout-tip-color:#3c8460}</style><link href=https://shankun.github.io/main.css rel=stylesheet><link href=https://shankun.github.io/hl-light.css id=hl rel=stylesheet><link crossorigin href=https://fastly.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css integrity=sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV rel=stylesheet><script crossorigin defer integrity=sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8 src=https://fastly.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js></script><script crossorigin defer integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 src=https://fastly.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:'$$',right:'$$',display:true},{left:'$',right:'$',display:false},{left:'\\(',right:'\\)',display:false},{left:'\\[',right:'\\]',display:true}],throwOnError:false})})</script><body class=post><script>const theme = sessionStorage.getItem('theme');
    const match = window.matchMedia("(prefers-color-scheme: dark)").matches
    if ((theme && theme == 'dark') || (!theme && match)) {
      document.body.classList.add('dark');
      const hl = document.querySelector('link#hl');
      if (hl) hl.href = https://shankun.github.io/hl-dark.css;
    }</script><header class=blur><div id=header-wrapper><nav><a class=instant href=https://shankun.github.io>æ¯ä¸€å¤©éƒ½æ˜¯ç¦»åˆ«</a><button aria-label="toggle expand" class=separator id=toggler>ğŸš€</button><span class="wrap left fold">{</span><a class=instant href=https://shankun.github.io/posts>articles</a><span class="wrap-separator fold">,</span><a class="instant fold" href=https://shankun.github.io/projects>projects</a><span class="wrap right fold">} ;</span></nav><div id=btns><button aria-label="theme switch" data-moon-icon='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20"><path d="M10 7C10 10.866 13.134 14 17 14C18.9584 14 20.729 13.1957 21.9995 11.8995C22 11.933 22 11.9665 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C12.0335 2 12.067 2 12.1005 2.00049C10.8043 3.27098 10 5.04157 10 7ZM4 12C4 16.4183 7.58172 20 12 20C15.0583 20 17.7158 18.2839 19.062 15.7621C18.3945 15.9187 17.7035 16 17 16C12.0294 16 8 11.9706 8 7C8 6.29648 8.08133 5.60547 8.2379 4.938C5.71611 6.28423 4 8.9417 4 12Z" fill="currentColor"></path></svg>' data-sun-icon='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20"><path d="M12 18C8.68629 18 6 15.3137 6 12C6 8.68629 8.68629 6 12 6C15.3137 6 18 8.68629 18 12C18 15.3137 15.3137 18 12 18ZM12 16C14.2091 16 16 14.2091 16 12C16 9.79086 14.2091 8 12 8C9.79086 8 8 9.79086 8 12C8 14.2091 9.79086 16 12 16ZM11 1H13V4H11V1ZM11 20H13V23H11V20ZM3.51472 4.92893L4.92893 3.51472L7.05025 5.63604L5.63604 7.05025L3.51472 4.92893ZM16.9497 18.364L18.364 16.9497L20.4853 19.0711L19.0711 20.4853L16.9497 18.364ZM19.0711 3.51472L20.4853 4.92893L18.364 7.05025L16.9497 5.63604L19.0711 3.51472ZM5.63604 16.9497L7.05025 18.364L4.92893 20.4853L3.51472 19.0711L5.63604 16.9497ZM23 11V13H20V11H23ZM4 11V13H1V11H4Z" fill="currentColor"></path></svg>' id=theme-toggle><svg viewbox="0 0 24 24" height=20 width=20 xmlns=http://www.w3.org/2000/svg><path d="M10 7C10 10.866 13.134 14 17 14C18.9584 14 20.729 13.1957 21.9995 11.8995C22 11.933 22 11.9665 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C12.0335 2 12.067 2 12.1005 2.00049C10.8043 3.27098 10 5.04157 10 7ZM4 12C4 16.4183 7.58172 20 12 20C15.0583 20 17.7158 18.2839 19.062 15.7621C18.3945 15.9187 17.7035 16 17 16C12.0294 16 8 11.9706 8 7C8 6.29648 8.08133 5.60547 8.2379 4.938C5.71611 6.28423 4 8.9417 4 12Z" fill=currentColor></path></svg></button><button aria-label="table of content" id=toc-toggle><svg viewbox="0 0 24 24" height=20 width=20 xmlns=http://www.w3.org/2000/svg><path d="M3 4H21V6H3V4ZM3 11H15V13H3V11ZM3 18H21V20H3V18Z" fill=currentColor></path></svg></button></div></div></header><div id=wrapper><div id=blank></div><aside><nav><ul><li><a class=h2 href=#monad>Monad</a> <ul><li><a class=h3 href=#pointed-functor>pointed functor</a><li><a class=h3 href=#hun-he-bi-yu>æ··åˆæ¯”å–»</a><li><a class=h3 href=#chain-han-shu>chain å‡½æ•°</a><li><a class=h3 href=#xuan-yao>ç‚«è€€</a></ul><li><a class=h2 href=#li-lun>ç†è®º</a> <ul><li><a class=h3 href=#zong-jie>æ€»ç»“</a><li><a class=h3 href=#lian-xi>ç»ƒä¹ </a></ul></ul></nav><button aria-label="back to top" id=back-to-top><svg viewbox="0 0 24 24" height=24 width=24 xmlns=http://www.w3.org/2000/svg><path d="M11.9997 10.8284L7.04996 15.7782L5.63574 14.364L11.9997 8L18.3637 14.364L16.9495 15.7782L11.9997 10.8284Z" fill=currentColor></path></svg></button></aside><main><div><div data-check-icon='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20"><path d="M10.0007 15.1709L19.1931 5.97852L20.6073 7.39273L10.0007 17.9993L3.63672 11.6354L5.05093 10.2212L10.0007 15.1709Z" fill="currentColor"></path></svg>' data-copy-icon='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20"><path d="M6.9998 6V3C6.9998 2.44772 7.44752 2 7.9998 2H19.9998C20.5521 2 20.9998 2.44772 20.9998 3V17C20.9998 17.5523 20.5521 18 19.9998 18H16.9998V20.9991C16.9998 21.5519 16.5499 22 15.993 22H4.00666C3.45059 22 3 21.5554 3 20.9991L3.0026 7.00087C3.0027 6.44811 3.45264 6 4.00942 6H6.9998ZM5.00242 8L5.00019 20H14.9998V8H5.00242ZM8.9998 6H16.9998V16H18.9998V4H8.9998V6Z" fill="currentColor"></path></svg>' id=copy-cfg style=display:none></div><article data-backlink-icon='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20"><path d="M9.41421 8L18.0208 16.6066L16.6066 18.0208L8 9.41421V17H6V6H17V8H9.41421Z" fill="currentColor"></path></svg>' class=prose><h1>å‡½æ•°å¼ç¼–ç¨‹æŒ‡å—ä¸­æ–‡ç‰ˆç¬¬9ç« </h1><div id=post-info><div id=date><span id=publish>2023-11-21</span></div><div id=tags><a class=instant href=https://shankun.github.io/tags/programming><span>#</span>programming</a><a class=instant href=https://shankun.github.io/tags/javascript><span>#</span>javascript</a></div></div><p><a rel="nofollow noreferrer" href=https://mostly-adequate.gitbook.io/mostly-adequate-guide/ch09>åŸæ–‡é“¾æ¥</a> â€ƒâ€ƒ <a href=../mostly-adequate-guide/#mu-lu>è¿”å›ç›®å½•</a><h1 id=monad>Monad<a aria-label="Anchor link for: monad" class=zola-anchor href=#monad style=visibility:hidden>#</a></h1><h2 id=pointed-functor>pointed functor<a aria-label="Anchor link for: pointed-functor" class=zola-anchor href=#pointed-functor style=visibility:hidden>#</a></h2><p>åœ¨ç»§ç»­åé¢çš„å†…å®¹ä¹‹å‰ï¼Œæˆ‘å¾—å‘ä½ å¦ç™½ä¸€ä»¶äº‹ï¼šå…³äºæˆ‘ä»¬å…ˆå‰åˆ›å»ºçš„å®¹å™¨ç±»å‹ä¸Šçš„ <code>of</code> æ–¹æ³•ï¼Œæˆ‘å¹¶æ²¡æœ‰è¯´å‡ºå®ƒçš„å…¨éƒ¨å®æƒ…ã€‚çœŸå®æƒ…å†µæ˜¯ï¼Œ<code>of</code> æ–¹æ³•ä¸æ˜¯ç”¨æ¥é¿å…ä½¿ç”¨ <code>new</code> å…³é”®å­—çš„ï¼Œè€Œæ˜¯ç”¨æ¥æŠŠå€¼æ”¾åˆ°<em>é»˜è®¤æœ€å°åŒ–ä¸Šä¸‹æ–‡</em>ï¼ˆdefault minimal contextï¼‰ä¸­çš„ã€‚æ˜¯çš„ï¼Œ<code>of</code> æ²¡æœ‰çœŸæ­£åœ°å–ä»£æ„é€ å™¨â€”â€”å®ƒæ˜¯ä¸€ä¸ªæˆ‘ä»¬ç§°ä¹‹ä¸º <em>pointed</em> çš„é‡è¦æ¥å£çš„ä¸€éƒ¨åˆ†ã€‚<blockquote><p><em>pointed functor</em> æ˜¯å®ç°äº† <code>of</code> æ–¹æ³•çš„ functorã€‚</blockquote><p>è¿™é‡Œçš„å…³é”®æ˜¯æŠŠä»»æ„å€¼ä¸¢åˆ°å®¹å™¨é‡Œç„¶åå¼€å§‹åˆ°å¤„ä½¿ç”¨ <code>map</code> çš„èƒ½åŠ›ã€‚<pre class="language-js z-code" data-lang=js><code class=language-js data-lang=js><span class="z-source z-ts"><span class="z-meta z-function-call z-ts"><span class="z-variable z-other z-constant z-object z-ts">IO</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-entity z-name z-function z-ts">of</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-string z-quoted z-double z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">"</span>tetris<span class="z-punctuation z-definition z-string z-end z-ts">"</span></span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-meta z-function-call z-ts"><span class="z-punctuation z-accessor z-ts">.</span><span class="z-entity z-name z-function z-ts">map</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">concat</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-string z-quoted z-double z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">"</span> master<span class="z-punctuation z-definition z-string z-end z-ts">"</span></span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts"> IO("tetris master")</span>

<span class="z-meta z-function-call z-ts"><span class="z-variable z-other z-object z-ts">Maybe</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-entity z-name z-function z-ts">of</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-constant z-numeric z-decimal z-ts">1336</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-meta z-function-call z-ts"><span class="z-punctuation z-accessor z-ts">.</span><span class="z-entity z-name z-function z-ts">map</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">add</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-constant z-numeric z-decimal z-ts">1</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts"> Maybe(1337)</span>

<span class="z-meta z-function-call z-ts"><span class="z-variable z-other z-object z-ts">Task</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-entity z-name z-function z-ts">of</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-array z-literal z-ts"><span class="z-meta z-brace z-square z-ts">[</span><span class="z-meta z-objectliteral z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span><span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts">id</span></span><span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts"><span class="z-punctuation z-separator z-key-value z-ts">:</span></span> <span class="z-constant z-numeric z-decimal z-ts">2</span></span><span class="z-punctuation z-definition z-block z-ts">}</span></span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-meta z-objectliteral z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span><span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts">id</span></span><span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts"><span class="z-punctuation z-separator z-key-value z-ts">:</span></span> <span class="z-constant z-numeric z-decimal z-ts">3</span></span><span class="z-punctuation z-definition z-block z-ts">}</span></span><span class="z-meta z-brace z-square z-ts">]</span></span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-meta z-function-call z-ts"><span class="z-punctuation z-accessor z-ts">.</span><span class="z-entity z-name z-function z-ts">map</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-function-call z-ts"><span class="z-variable z-other z-object z-ts">_</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-entity z-name z-function z-ts">prop</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-string z-quoted z-single z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">'</span>id<span class="z-punctuation z-definition z-string z-end z-ts">'</span></span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts"> Task([2,3])</span>

<span class="z-meta z-function-call z-ts"><span class="z-variable z-other z-object z-ts">Either</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-entity z-name z-function z-ts">of</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-string z-quoted z-double z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">"</span>The past, present and future walk into a bar...<span class="z-punctuation z-definition z-string z-end z-ts">"</span></span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-meta z-function-call z-ts"><span class="z-punctuation z-accessor z-ts">.</span><span class="z-entity z-name z-function z-ts">map</span></span><span class="z-meta z-brace z-round z-ts">(</span>
  <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">concat</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-string z-quoted z-double z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">"</span>it was tense.<span class="z-punctuation z-definition z-string z-end z-ts">"</span></span><span class="z-meta z-brace z-round z-ts">)</span>
<span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts"> Right("The past, present and future walk into a bar...it was tense.")</span>
</span></code></pre><p>å¦‚æœä½ è¿˜è®°å¾—ï¼Œ<code>IO</code> å’Œ <code>Task</code> çš„æ„é€ å™¨æ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè€Œ <code>Maybe</code> å’Œ <code>Either</code> çš„æ„é€ å™¨å¯ä»¥æ¥å—ä»»æ„å€¼ã€‚å®ç°è¿™ç§æ¥å£çš„åŠ¨æœºæ˜¯ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½æœ‰ä¸€ç§é€šç”¨ã€ä¸€è‡´çš„æ–¹å¼å¾€ functor é‡Œå¡«å€¼ï¼Œè€Œä¸”ä¸­é—´ä¸ä¼šæ¶‰åŠåˆ°å¤æ‚æ€§ï¼Œä¹Ÿä¸ä¼šæ¶‰åŠåˆ°å¯¹æ„é€ å™¨çš„ç‰¹å®šè¦æ±‚ã€‚â€œé»˜è®¤æœ€å°åŒ–ä¸Šä¸‹æ–‡â€è¿™ä¸ªæœ¯è¯­å¯èƒ½ä¸å¤Ÿç²¾ç¡®ï¼Œä½†æ˜¯å´å¾ˆå¥½åœ°ä¼ è¾¾äº†è¿™ç§ç†å¿µï¼šæˆ‘ä»¬å¸Œæœ›å®¹å™¨ç±»å‹é‡Œçš„ä»»æ„å€¼éƒ½èƒ½å‘ç”Ÿ <code>lift</code>ï¼Œç„¶ååƒæ‰€æœ‰çš„ functor é‚£æ ·å† <code>map</code> å‡ºå»ã€‚<p>æœ‰ä»¶å¾ˆé‡è¦çš„äº‹æˆ‘å¿…é¡»å¾—åœ¨è¿™é‡Œçº æ­£ï¼Œé‚£å°±æ˜¯ï¼Œ<code>Left.of</code> æ²¡æœ‰ä»»ä½•é“ç†å¯è¨€ï¼ŒåŒ…æ‹¬å®ƒçš„åŒå…³è¯­ä¹Ÿæ˜¯ã€‚æ¯ä¸ª functor éƒ½è¦æœ‰ä¸€ç§æŠŠå€¼æ”¾è¿›å»çš„æ–¹å¼ï¼Œå¯¹ <code>Either</code> æ¥è¯´ï¼Œå®ƒçš„æ–¹å¼å°±æ˜¯ <code>new Right(x)</code>ã€‚æˆ‘ä»¬ä¸º <code>Right</code> å®šä¹‰ <code>of</code> çš„åŸå› æ˜¯ï¼Œå¦‚æœä¸€ä¸ªç±»å‹å®¹å™¨<em>å¯ä»¥</em> <code>map</code>ï¼Œé‚£å®ƒå°±<em>åº”è¯¥</em> <code>map</code>ã€‚çœ‹ä¸Šé¢çš„ä¾‹å­ï¼Œä½ åº”è¯¥ä¼šå¯¹ <code>of</code> é€šå¸¸çš„å·¥ä½œæ¨¡å¼æœ‰ä¸€ä¸ªç›´è§‚çš„å°è±¡ï¼Œè€Œ <code>Left</code> ç ´åäº†è¿™ç§æ¨¡å¼ã€‚<p>ä½ å¯èƒ½å·²ç»å¬è¯´è¿‡ <code>pure</code>ã€<code>point</code>ã€<code>unit</code> å’Œ <code>return</code> ä¹‹ç±»çš„å‡½æ•°äº†ï¼Œå®ƒä»¬éƒ½æ˜¯ <code>of</code> è¿™ä¸ªå²ä¸Šæœ€ç¥ç§˜å‡½æ•°çš„ä¸åŒåç§°ï¼ˆè¯‘è€…æ³¨ï¼šæ­¤å¤„åŸæ–‡æ˜¯â€œinternational function of mysteryâ€ï¼Œæºè‡ªæ¶æã€Š007ã€‹çš„ç”µå½± <em>Austin Powers: International Man of Mystery</em>ï¼Œä¸­è¯‘åã€Šç‹ç‰Œå¤§è´±è°ã€‹ï¼‰ã€‚<code>of</code> å°†åœ¨æˆ‘ä»¬å¼€å§‹ä½¿ç”¨ monad çš„æ—¶å€™æ˜¾ç¤ºå…¶é‡è¦æ€§ï¼Œå› ä¸ºåé¢ä½ ä¼šçœ‹åˆ°ï¼Œæ‰‹åŠ¨æŠŠå€¼æ”¾å›å®¹å™¨æ˜¯æˆ‘ä»¬è‡ªå·±çš„è´£ä»»ã€‚<p>è¦é¿å… <code>new</code> å…³é”®å­—ï¼Œå¯ä»¥å€ŸåŠ©ä¸€äº›æ ‡å‡†çš„ JavaScript æŠ€å·§æˆ–è€…ç±»åº“è¾¾åˆ°ç›®çš„ã€‚æ‰€ä»¥ä»è¿™é‡Œå¼€å§‹ï¼Œæˆ‘ä»¬å°±åˆ©ç”¨è¿™äº›æŠ€å·§æˆ–ç±»åº“ï¼Œåƒä¸€ä¸ªè´Ÿè´£ä»»çš„æˆå¹´äººé‚£æ ·ä½¿ç”¨ <code>of</code>ã€‚æˆ‘æ¨èä½¿ç”¨ <code>folktale</code>ã€<code>ramda</code> æˆ– <code>fantasy-land</code> é‡Œçš„ functor å®ä¾‹ï¼Œå› ä¸ºå®ƒä»¬åŒæ—¶æä¾›äº†æ­£ç¡®çš„ <code>of</code> æ–¹æ³•å’Œä¸ä¾èµ– <code>new</code> çš„æ„é€ å™¨ã€‚<h2 id=hun-he-bi-yu>æ··åˆæ¯”å–»<a aria-label="Anchor link for: hun-he-bi-yu" class=zola-anchor href=#hun-he-bi-yu style=visibility:hidden>#</a></h2><p>{{ figure(src="/imgsrc="images/onion.png" alt="http://www.organicchemistry.com/wp-content/uploads/BPOCchapter6-6htm-41.png") }}<p>ä½ çœ‹ï¼Œé™¤äº†å¤ªç©ºå¢¨è¥¿å“¥å·ï¼ˆå¦‚æœä½ å¬è¯´è¿‡è¿™ä¸ªä¼ è¨€çš„è¯ï¼‰ï¼ˆè¯‘è€…æ³¨ï¼šæ­¤å¤„çš„ä¼ è¨€ä¼¼ä¹æ˜¯è¯´ä¸€ä¸ªå« Chris Hadfield çš„å®‡èˆªå‘˜åœ¨å›½é™…ç©ºé—´ç«™åšå¢¨è¥¿å“¥å·çš„äº‹ï¼Œ<a href="https://www.youtube.com/watch?v=f8-UKqGZ_hs" rel="nofollow noreferrer">è§†é¢‘é“¾æ¥</a>ï¼‰ï¼Œmonad è¿˜è¢«å–»ä¸ºæ´‹è‘±ã€‚è®©æˆ‘ä»¥ä¸€ä¸ªå¸¸è§çš„åœºæ™¯æ¥è¯´æ˜è¿™ç‚¹ï¼š<pre class="language-js z-code" data-lang=js><code class=language-js data-lang=js><span class="z-source z-ts"><span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts"> Support</span>
<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts"> ===========================</span>
<span class="z-meta z-var z-expr z-ts"><span class="z-storage z-type z-ts">var</span> <span class="z-meta z-var-single-variable z-expr z-ts"><span class="z-meta z-definition z-variable z-ts"><span class="z-variable z-other z-readwrite z-ts">fs</span></span> </span><span class="z-keyword z-operator z-assignment z-ts">=</span> <span class="z-meta z-function-call z-ts"><span class="z-support z-function z-ts">require</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-string z-quoted z-single z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">'</span>fs<span class="z-punctuation z-definition z-string z-end z-ts">'</span></span><span class="z-meta z-brace z-round z-ts">)</span></span><span class="z-punctuation z-terminator z-statement z-ts">;</span>

<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts">  readFile :: String -> IO String</span>
<span class="z-meta z-var z-expr z-ts"><span class="z-storage z-type z-ts">var</span> <span class="z-meta z-var-single-variable z-expr z-ts"><span class="z-meta z-definition z-variable z-ts"><span class="z-entity z-name z-function z-ts">readFile</span></span> </span><span class="z-keyword z-operator z-assignment z-ts">=</span> <span class="z-meta z-function z-expression z-ts"><span class="z-storage z-type z-function z-ts">function</span><span class="z-meta z-parameters z-ts"><span class="z-punctuation z-definition z-parameters z-begin z-ts">(</span><span class="z-variable z-parameter z-ts">filename</span><span class="z-punctuation z-definition z-parameters z-end z-ts">)</span></span> <span class="z-meta z-block z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span>
  <span class="z-keyword z-control z-flow z-ts">return</span> <span class="z-new z-expr z-ts"><span class="z-keyword z-operator z-new z-ts">new</span> <span class="z-entity z-name z-type z-ts">IO</span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-function z-expression z-ts"><span class="z-storage z-type z-function z-ts">function</span><span class="z-meta z-parameters z-ts"><span class="z-punctuation z-definition z-parameters z-begin z-ts">(</span><span class="z-punctuation z-definition z-parameters z-end z-ts">)</span></span> <span class="z-meta z-block z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span>
    <span class="z-keyword z-control z-flow z-ts">return</span> <span class="z-meta z-function-call z-ts"><span class="z-variable z-other z-object z-ts">fs</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-entity z-name z-function z-ts">readFileSync</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-variable z-other z-readwrite z-ts">filename</span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-string z-quoted z-single z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">'</span>utf-8<span class="z-punctuation z-definition z-string z-end z-ts">'</span></span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
  <span class="z-punctuation z-definition z-block z-ts">}</span></span></span><span class="z-meta z-brace z-round z-ts">)</span></span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
<span class="z-punctuation z-definition z-block z-ts">}</span></span></span></span><span class="z-punctuation z-terminator z-statement z-ts">;</span>

<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts">  print :: String -> IO String</span>
<span class="z-meta z-var z-expr z-ts"><span class="z-storage z-type z-ts">var</span> <span class="z-meta z-var-single-variable z-expr z-ts"><span class="z-meta z-definition z-variable z-ts"><span class="z-entity z-name z-function z-ts">print</span></span> </span><span class="z-keyword z-operator z-assignment z-ts">=</span> <span class="z-meta z-function z-expression z-ts"><span class="z-storage z-type z-function z-ts">function</span><span class="z-meta z-parameters z-ts"><span class="z-punctuation z-definition z-parameters z-begin z-ts">(</span><span class="z-variable z-parameter z-ts">x</span><span class="z-punctuation z-definition z-parameters z-end z-ts">)</span></span> <span class="z-meta z-block z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span>
  <span class="z-keyword z-control z-flow z-ts">return</span> <span class="z-new z-expr z-ts"><span class="z-keyword z-operator z-new z-ts">new</span> <span class="z-entity z-name z-type z-ts">IO</span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-function z-expression z-ts"><span class="z-storage z-type z-function z-ts">function</span><span class="z-meta z-parameters z-ts"><span class="z-punctuation z-definition z-parameters z-begin z-ts">(</span><span class="z-punctuation z-definition z-parameters z-end z-ts">)</span></span> <span class="z-meta z-block z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span>
    <span class="z-meta z-function-call z-ts"><span class="z-support z-class z-console z-ts">console</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-support z-function z-console z-ts">log</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-variable z-other z-readwrite z-ts">x</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
    <span class="z-keyword z-control z-flow z-ts">return</span> <span class="z-variable z-other z-readwrite z-ts">x</span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
  <span class="z-punctuation z-definition z-block z-ts">}</span></span></span><span class="z-meta z-brace z-round z-ts">)</span></span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
<span class="z-punctuation z-definition z-block z-ts">}</span></span></span></span>

<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts"> Example</span>
<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts"> ===========================</span>
<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts">  cat :: IO (IO String)</span>
<span class="z-meta z-var z-expr z-ts"><span class="z-storage z-type z-ts">var</span> <span class="z-meta z-var-single-variable z-expr z-ts"><span class="z-meta z-definition z-variable z-ts"><span class="z-variable z-other z-readwrite z-ts">cat</span></span> </span><span class="z-keyword z-operator z-assignment z-ts">=</span> <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">compose</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">map</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-variable z-other z-readwrite z-ts">print</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-variable z-other z-readwrite z-ts">readFile</span><span class="z-meta z-brace z-round z-ts">)</span></span><span class="z-punctuation z-terminator z-statement z-ts">;</span>

<span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">cat</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-string z-quoted z-double z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">"</span>.git/config<span class="z-punctuation z-definition z-string z-end z-ts">"</span></span><span class="z-meta z-brace z-round z-ts">)</span>
<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts"> IO(IO("[core]\nrepositoryformatversion = 0\n"))</span>
</span></code></pre><p>è¿™é‡Œæˆ‘ä»¬å¾—åˆ°çš„æ˜¯ä¸€ä¸ª <code>IO</code>ï¼Œåªä¸è¿‡å®ƒé™·è¿›äº†å¦ä¸€ä¸ª <code>IO</code>ã€‚è¦æƒ³ä½¿ç”¨å®ƒï¼Œæˆ‘ä»¬å¿…é¡»è¿™æ ·è°ƒç”¨ï¼š <code>map(map(f))</code>ï¼›è¦æƒ³è§‚å¯Ÿå®ƒçš„ä½œç”¨ï¼Œå¿…é¡»è¿™æ ·ï¼š <code>unsafePerformIO().unsafePerformIO()</code>ã€‚<pre class="language-js z-code" data-lang=js><code class=language-js data-lang=js><span class="z-source z-ts"><span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts">  cat :: String -> IO (IO String)</span>
<span class="z-meta z-var z-expr z-ts"><span class="z-storage z-type z-ts">var</span> <span class="z-meta z-var-single-variable z-expr z-ts"><span class="z-meta z-definition z-variable z-ts"><span class="z-variable z-other z-readwrite z-ts">cat</span></span> </span><span class="z-keyword z-operator z-assignment z-ts">=</span> <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">compose</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">map</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-variable z-other z-readwrite z-ts">print</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-variable z-other z-readwrite z-ts">readFile</span><span class="z-meta z-brace z-round z-ts">)</span></span><span class="z-punctuation z-terminator z-statement z-ts">;</span>

<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts">  catFirstChar :: String -> IO (IO String)</span>
<span class="z-meta z-var z-expr z-ts"><span class="z-storage z-type z-ts">var</span> <span class="z-meta z-var-single-variable z-expr z-ts"><span class="z-meta z-definition z-variable z-ts"><span class="z-variable z-other z-readwrite z-ts">catFirstChar</span></span> </span><span class="z-keyword z-operator z-assignment z-ts">=</span> <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">compose</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">map</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">map</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-variable z-other z-readwrite z-ts">head</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-variable z-other z-readwrite z-ts">cat</span><span class="z-meta z-brace z-round z-ts">)</span></span><span class="z-punctuation z-terminator z-statement z-ts">;</span>

<span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">catFirstChar</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-string z-quoted z-double z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">"</span>.git/config<span class="z-punctuation z-definition z-string z-end z-ts">"</span></span><span class="z-meta z-brace z-round z-ts">)</span>
<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts"> IO(IO("["))</span>
</span></code></pre><p>å°½ç®¡åœ¨åº”ç”¨ä¸­æŠŠè¿™ä¸¤ä¸ªä½œç”¨æ‰“åŒ…åœ¨ä¸€èµ·æ²¡ä»€ä¹ˆä¸å¥½çš„ï¼Œä½†æ€»æ„Ÿè§‰åƒæ˜¯åœ¨ç©¿ç€ä¸¤å¥—é˜²æŠ¤æœå·¥ä½œï¼Œç»“æœå°±å½¢æˆä¸€ä¸ªç¨€å¥‡å¤æ€ªçš„ APIã€‚å†æ¥çœ‹å¦ä¸€ç§æƒ…å†µï¼š<pre class="language-js z-code" data-lang=js><code class=language-js data-lang=js><span class="z-source z-ts"><span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts">  safeProp :: Key -> {Key: a} -> Maybe a</span>
<span class="z-meta z-var z-expr z-ts"><span class="z-storage z-type z-ts">var</span> <span class="z-meta z-var-single-variable z-expr z-ts"><span class="z-meta z-definition z-variable z-ts"><span class="z-variable z-other z-readwrite z-ts">safeProp</span></span> </span><span class="z-keyword z-operator z-assignment z-ts">=</span> <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">curry</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-function z-expression z-ts"><span class="z-storage z-type z-function z-ts">function</span><span class="z-meta z-parameters z-ts"><span class="z-punctuation z-definition z-parameters z-begin z-ts">(</span><span class="z-variable z-parameter z-ts">x</span><span class="z-punctuation z-separator z-parameter z-ts">,</span> <span class="z-variable z-parameter z-ts">obj</span><span class="z-punctuation z-definition z-parameters z-end z-ts">)</span></span> <span class="z-meta z-block z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span>
  <span class="z-keyword z-control z-flow z-ts">return</span> <span class="z-new z-expr z-ts"><span class="z-keyword z-operator z-new z-ts">new</span> <span class="z-entity z-name z-type z-ts">Maybe</span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-variable z-other z-readwrite z-ts">obj</span><span class="z-meta z-array z-literal z-ts"><span class="z-meta z-brace z-square z-ts">[</span><span class="z-variable z-other z-readwrite z-ts">x</span><span class="z-meta z-brace z-square z-ts">]</span></span><span class="z-meta z-brace z-round z-ts">)</span></span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
<span class="z-punctuation z-definition z-block z-ts">}</span></span></span><span class="z-meta z-brace z-round z-ts">)</span></span><span class="z-punctuation z-terminator z-statement z-ts">;</span>

<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts">  safeHead :: [a] -> Maybe a</span>
<span class="z-meta z-var z-expr z-ts"><span class="z-storage z-type z-ts">var</span> <span class="z-meta z-var-single-variable z-expr z-ts"><span class="z-meta z-definition z-variable z-ts"><span class="z-variable z-other z-readwrite z-ts">safeHead</span></span> </span><span class="z-keyword z-operator z-assignment z-ts">=</span> <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">safeProp</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-constant z-numeric z-decimal z-ts">0</span><span class="z-meta z-brace z-round z-ts">)</span></span><span class="z-punctuation z-terminator z-statement z-ts">;</span>

<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts">  firstAddressStreet :: User -> Maybe (Maybe (Maybe Street) )</span>
<span class="z-meta z-var z-expr z-ts"><span class="z-storage z-type z-ts">var</span> <span class="z-meta z-var-single-variable z-expr z-ts"><span class="z-meta z-definition z-variable z-ts"><span class="z-variable z-other z-readwrite z-ts">firstAddressStreet</span></span> </span><span class="z-keyword z-operator z-assignment z-ts">=</span> <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">compose</span></span><span class="z-meta z-brace z-round z-ts">(</span>
  <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">map</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">map</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">safeProp</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-string z-quoted z-single z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">'</span>street<span class="z-punctuation z-definition z-string z-end z-ts">'</span></span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">map</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-variable z-other z-readwrite z-ts">safeHead</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">safeProp</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-string z-quoted z-single z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">'</span>addresses<span class="z-punctuation z-definition z-string z-end z-ts">'</span></span><span class="z-meta z-brace z-round z-ts">)</span>
<span class="z-meta z-brace z-round z-ts">)</span></span><span class="z-punctuation z-terminator z-statement z-ts">;</span>

<span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">firstAddressStreet</span></span><span class="z-meta z-brace z-round z-ts">(</span>
  <span class="z-meta z-objectliteral z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span><span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts">addresses</span></span><span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts"><span class="z-punctuation z-separator z-key-value z-ts">:</span></span><span class="z-meta z-array z-literal z-ts"> <span class="z-meta z-brace z-square z-ts">[</span><span class="z-meta z-objectliteral z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span><span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts">street</span></span><span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts"><span class="z-punctuation z-separator z-key-value z-ts">:</span></span> <span class="z-meta z-objectliteral z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span><span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts">name</span></span><span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts"><span class="z-punctuation z-separator z-key-value z-ts">:</span></span> <span class="z-string z-quoted z-single z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">'</span>Mulburry<span class="z-punctuation z-definition z-string z-end z-ts">'</span></span></span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts">number</span></span><span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts"><span class="z-punctuation z-separator z-key-value z-ts">:</span></span> <span class="z-constant z-numeric z-decimal z-ts">8402</span></span><span class="z-punctuation z-definition z-block z-ts">}</span></span></span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts">postcode</span></span><span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts"><span class="z-punctuation z-separator z-key-value z-ts">:</span></span> <span class="z-string z-quoted z-double z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">"</span>WC2N<span class="z-punctuation z-definition z-string z-end z-ts">"</span></span> </span><span class="z-punctuation z-definition z-block z-ts">}</span></span><span class="z-meta z-brace z-square z-ts">]</span></span></span><span class="z-punctuation z-definition z-block z-ts">}</span></span>
<span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts"> Maybe(Maybe(Maybe({name: 'Mulburry', number: 8402})))</span>
</span></code></pre><p>è¿™é‡Œçš„ functor åŒæ ·æ˜¯åµŒå¥—çš„ï¼Œå‡½æ•°ä¸­ä¸‰ä¸ªå¯èƒ½çš„å¤±è´¥éƒ½ç”¨äº† <code>Maybe</code> åšé¢„é˜²ä¹Ÿå¾ˆå¹²å‡€æ•´æ´ï¼Œä½†æ˜¯è¦è®©æœ€åçš„è°ƒç”¨è€…è°ƒç”¨ä¸‰æ¬¡ <code>map</code> æ‰èƒ½å–åˆ°å€¼æœªå…ä¹Ÿå¤ªæ— ç¤¼äº†ç‚¹â€”â€”æˆ‘ä»¬å’Œå®ƒæ‰åˆšåˆšè§é¢è€Œå·²ã€‚è¿™ç§åµŒå¥— functor çš„æ¨¡å¼ä¼šæ—¶ä¸æ—¶åœ°å‡ºç°ï¼Œè€Œä¸”æ˜¯ monad çš„ä¸»è¦ä½¿ç”¨åœºæ™¯ã€‚<p>æˆ‘è¯´è¿‡ monad åƒæ´‹è‘±ï¼Œé‚£æ˜¯å› ä¸ºå½“æˆ‘ä»¬ç”¨ <code>map</code> å‰¥å¼€åµŒå¥—çš„ functor ä»¥è·å–å®ƒé‡Œé¢çš„å€¼çš„æ—¶å€™ï¼Œå°±åƒå‰¥æ´‹è‘±ä¸€æ ·è®©äººå¿ä¸ä½æƒ³å“­ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬å¯ä»¥æ“¦å¹²çœ¼æ³ªï¼Œåšä¸ªæ·±å‘¼å¸ï¼Œç„¶åä½¿ç”¨ä¸€ä¸ªå«ä½œ <code>join</code> çš„æ–¹æ³•ã€‚<pre class="language-js z-code" data-lang=js><code class=language-js data-lang=js><span class="z-source z-ts"><span class="z-meta z-var z-expr z-ts"><span class="z-storage z-type z-ts">var</span> <span class="z-meta z-var-single-variable z-expr z-ts"><span class="z-meta z-definition z-variable z-ts"><span class="z-variable z-other z-readwrite z-ts">mmo</span></span> </span><span class="z-keyword z-operator z-assignment z-ts">=</span> <span class="z-meta z-function-call z-ts"><span class="z-variable z-other z-object z-ts">Maybe</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-entity z-name z-function z-ts">of</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-function-call z-ts"><span class="z-variable z-other z-object z-ts">Maybe</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-entity z-name z-function z-ts">of</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-string z-quoted z-double z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">"</span>nunchucks<span class="z-punctuation z-definition z-string z-end z-ts">"</span></span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-meta z-brace z-round z-ts">)</span></span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts"> Maybe(Maybe("nunchucks"))</span>

<span class="z-meta z-function-call z-ts"><span class="z-variable z-other z-object z-ts">mmo</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-support z-function z-ts">join</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts"> Maybe("nunchucks")</span>

<span class="z-meta z-var z-expr z-ts"><span class="z-storage z-type z-ts">var</span> <span class="z-meta z-var-single-variable z-expr z-ts"><span class="z-meta z-definition z-variable z-ts"><span class="z-variable z-other z-readwrite z-ts">ioio</span></span> </span><span class="z-keyword z-operator z-assignment z-ts">=</span> <span class="z-meta z-function-call z-ts"><span class="z-variable z-other z-constant z-object z-ts">IO</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-entity z-name z-function z-ts">of</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-function-call z-ts"><span class="z-variable z-other z-constant z-object z-ts">IO</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-entity z-name z-function z-ts">of</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-string z-quoted z-double z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">"</span>pizza<span class="z-punctuation z-definition z-string z-end z-ts">"</span></span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-meta z-brace z-round z-ts">)</span></span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts"> IO(IO("pizza"))</span>

<span class="z-meta z-function-call z-ts"><span class="z-variable z-other z-object z-ts">ioio</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-support z-function z-ts">join</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-brace z-round z-ts">)</span>
<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts"> IO("pizza")</span>

<span class="z-meta z-var z-expr z-ts"><span class="z-storage z-type z-ts">var</span> <span class="z-meta z-var-single-variable z-expr z-ts"><span class="z-meta z-definition z-variable z-ts"><span class="z-variable z-other z-readwrite z-ts">ttt</span></span> </span><span class="z-keyword z-operator z-assignment z-ts">=</span> <span class="z-meta z-function-call z-ts"><span class="z-variable z-other z-object z-ts">Task</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-entity z-name z-function z-ts">of</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-function-call z-ts"><span class="z-variable z-other z-object z-ts">Task</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-entity z-name z-function z-ts">of</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-function-call z-ts"><span class="z-variable z-other z-object z-ts">Task</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-entity z-name z-function z-ts">of</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-string z-quoted z-double z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">"</span>sewers<span class="z-punctuation z-definition z-string z-end z-ts">"</span></span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-meta z-brace z-round z-ts">)</span></span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts"> Task(Task(Task("sewers")));</span>

<span class="z-meta z-function-call z-ts"><span class="z-variable z-other z-object z-ts">ttt</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-support z-function z-ts">join</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-brace z-round z-ts">)</span>
<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts"> Task(Task("sewers"))</span>
</span></code></pre><p>å¦‚æœæœ‰ä¸¤å±‚ç›¸åŒç±»å‹çš„åµŒå¥—ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç”¨ <code>join</code> æŠŠå®ƒä»¬å‹æ‰åˆ°ä¸€å—å»ã€‚è¿™ç§ç»“åˆçš„èƒ½åŠ›ï¼Œfunctor ä¹‹é—´çš„è”å§»ï¼Œå°±æ˜¯ monad ä¹‹æ‰€ä»¥æˆä¸º monad çš„åŸå› ã€‚æ¥çœ‹çœ‹å®ƒæ›´ç²¾ç¡®çš„å®Œæ•´å®šä¹‰ï¼š<blockquote><p>monad æ˜¯å¯ä»¥å˜æ‰ï¼ˆflattenï¼‰çš„ pointed functorã€‚</blockquote><p>ä¸€ä¸ª functorï¼Œåªè¦å®ƒå®šä¹‰ä¸ªäº†ä¸€ä¸ª <code>join</code> æ–¹æ³•å’Œä¸€ä¸ª <code>of</code> æ–¹æ³•ï¼Œå¹¶éµå®ˆä¸€äº›å®šå¾‹ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä¸€ä¸ª monadã€‚<code>join</code> çš„å®ç°å¹¶ä¸å¤ªå¤æ‚ï¼Œæˆ‘ä»¬æ¥ä¸º <code>Maybe</code> å®šä¹‰ä¸€ä¸ªï¼š<pre class="language-js z-code" data-lang=js><code class=language-js data-lang=js><span class="z-source z-ts"><span class="z-support z-class z-ts">Maybe</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-support z-variable z-property z-ts">prototype</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-entity z-name z-function z-ts">join</span> <span class="z-keyword z-operator z-assignment z-ts">=</span> <span class="z-meta z-function z-ts"><span class="z-storage z-type z-function z-ts">function</span><span class="z-meta z-parameters z-ts"><span class="z-punctuation z-definition z-parameters z-begin z-ts">(</span><span class="z-punctuation z-definition z-parameters z-end z-ts">)</span></span> <span class="z-meta z-block z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span>
  <span class="z-keyword z-control z-flow z-ts">return</span> <span class="z-meta z-function-call z-ts"><span class="z-variable z-language z-this z-ts">this</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-entity z-name z-function z-ts">isNothing</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-brace z-round z-ts">)</span> <span class="z-keyword z-operator z-ternary z-ts">?</span> <span class="z-meta z-function-call z-ts"><span class="z-variable z-other z-object z-ts">Maybe</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-entity z-name z-function z-ts">of</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-constant z-language z-null z-ts">null</span><span class="z-meta z-brace z-round z-ts">)</span> <span class="z-keyword z-operator z-ternary z-ts">:</span> <span class="z-variable z-language z-this z-ts">this</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-variable z-other z-property z-ts">__value</span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
<span class="z-punctuation z-definition z-block z-ts">}</span></span></span>
</span></code></pre><p>çœ‹ï¼Œå°±åƒå­å®«é‡ŒåŒèƒèƒä¸­çš„ä¸€ä¸ªåƒæ‰å¦ä¸€ä¸ªé‚£ä¹ˆç®€å•ã€‚å¦‚æœæœ‰ä¸€ä¸ª <code>Maybe(Maybe(x))</code>ï¼Œé‚£ä¹ˆ <code>.__value</code> å°†ä¼šç§»é™¤å¤šä½™çš„ä¸€å±‚ï¼Œç„¶åæˆ‘ä»¬å°±èƒ½å®‰å¿ƒåœ°ä»é‚£å¼€å§‹è¿›è¡Œ <code>map</code>ã€‚è¦ä¸ç„¶ï¼Œæˆ‘ä»¬å°±å°†ä¼šåªæœ‰ä¸€ä¸ª <code>Maybe</code>ï¼Œå› ä¸ºä»ä¸€å¼€å§‹å°±æ²¡æœ‰ä»»ä½•ä¸œè¥¿è¢« <code>map</code> è°ƒç”¨ã€‚<p>æ—¢ç„¶å·²ç»æœ‰äº† <code>join</code> æ–¹æ³•ï¼Œæˆ‘ä»¬æŠŠ monad é­”æ³•ä½œç”¨åˆ° <code>firstAddressStreet</code> ä¾‹å­ä¸Šï¼Œçœ‹çœ‹å®ƒçš„å®é™…ä½œç”¨ï¼š<pre class="language-js z-code" data-lang=js><code class=language-js data-lang=js><span class="z-source z-ts"><span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts">  join :: Monad m => m (m a) -> m a</span>
<span class="z-meta z-var z-expr z-ts"><span class="z-storage z-type z-ts">var</span> <span class="z-meta z-var-single-variable z-expr z-ts"><span class="z-meta z-definition z-variable z-ts"><span class="z-entity z-name z-function z-ts">join</span></span> </span><span class="z-keyword z-operator z-assignment z-ts">=</span> <span class="z-meta z-function z-expression z-ts"><span class="z-storage z-type z-function z-ts">function</span><span class="z-meta z-parameters z-ts"><span class="z-punctuation z-definition z-parameters z-begin z-ts">(</span><span class="z-variable z-parameter z-ts">mma</span><span class="z-punctuation z-definition z-parameters z-end z-ts">)</span></span><span class="z-meta z-block z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span> <span class="z-keyword z-control z-flow z-ts">return</span> <span class="z-meta z-function-call z-ts"><span class="z-variable z-other z-object z-ts">mma</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-support z-function z-ts">join</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-terminator z-statement z-ts">;</span> <span class="z-punctuation z-definition z-block z-ts">}</span></span></span></span>

<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts">  firstAddressStreet :: User -> Maybe Street</span>
<span class="z-meta z-var z-expr z-ts"><span class="z-storage z-type z-ts">var</span> <span class="z-meta z-var-single-variable z-expr z-ts"><span class="z-meta z-definition z-variable z-ts"><span class="z-variable z-other z-readwrite z-ts">firstAddressStreet</span></span> </span><span class="z-keyword z-operator z-assignment z-ts">=</span> <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">compose</span></span><span class="z-meta z-brace z-round z-ts">(</span>
  <span class="z-variable z-other z-readwrite z-ts">join</span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">map</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">safeProp</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-string z-quoted z-single z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">'</span>street<span class="z-punctuation z-definition z-string z-end z-ts">'</span></span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-variable z-other z-readwrite z-ts">join</span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">map</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-variable z-other z-readwrite z-ts">safeHead</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">safeProp</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-string z-quoted z-single z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">'</span>addresses<span class="z-punctuation z-definition z-string z-end z-ts">'</span></span><span class="z-meta z-brace z-round z-ts">)</span>
<span class="z-meta z-brace z-round z-ts">)</span></span><span class="z-punctuation z-terminator z-statement z-ts">;</span>

<span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">firstAddressStreet</span></span><span class="z-meta z-brace z-round z-ts">(</span>
  <span class="z-meta z-objectliteral z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span><span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts">addresses</span></span><span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts"><span class="z-punctuation z-separator z-key-value z-ts">:</span></span><span class="z-meta z-array z-literal z-ts"> <span class="z-meta z-brace z-square z-ts">[</span><span class="z-meta z-objectliteral z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span><span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts">street</span></span><span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts"><span class="z-punctuation z-separator z-key-value z-ts">:</span></span> <span class="z-meta z-objectliteral z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span><span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts">name</span></span><span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts"><span class="z-punctuation z-separator z-key-value z-ts">:</span></span> <span class="z-string z-quoted z-single z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">'</span>Mulburry<span class="z-punctuation z-definition z-string z-end z-ts">'</span></span></span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts">number</span></span><span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts"><span class="z-punctuation z-separator z-key-value z-ts">:</span></span> <span class="z-constant z-numeric z-decimal z-ts">8402</span></span><span class="z-punctuation z-definition z-block z-ts">}</span></span></span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts">postcode</span></span><span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts"><span class="z-punctuation z-separator z-key-value z-ts">:</span></span> <span class="z-string z-quoted z-double z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">"</span>WC2N<span class="z-punctuation z-definition z-string z-end z-ts">"</span></span> </span><span class="z-punctuation z-definition z-block z-ts">}</span></span><span class="z-meta z-brace z-square z-ts">]</span></span></span><span class="z-punctuation z-definition z-block z-ts">}</span></span>
<span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts"> Maybe({name: 'Mulburry', number: 8402})</span>
</span></code></pre><p>åªè¦é‡åˆ°åµŒå¥—çš„ <code>Maybe</code>ï¼Œå°±åŠ ä¸€ä¸ª <code>join</code>ï¼Œé˜²æ­¢å®ƒä»¬ä»æ‰‹ä¸­æºœèµ°ã€‚æˆ‘ä»¬å¯¹ <code>IO</code> ä¹Ÿè¿™ä¹ˆåšè¯•è¯•çœ‹ï¼Œæ„Ÿå—ä¸‹è¿™ç§æ„Ÿè§‰ã€‚<pre class="language-js z-code" data-lang=js><code class=language-js data-lang=js><span class="z-source z-ts"><span class="z-support z-class z-ts">IO</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-support z-variable z-property z-ts">prototype</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-entity z-name z-function z-ts">join</span> <span class="z-keyword z-operator z-assignment z-ts">=</span> <span class="z-meta z-function z-ts"><span class="z-storage z-type z-function z-ts">function</span><span class="z-meta z-parameters z-ts"><span class="z-punctuation z-definition z-parameters z-begin z-ts">(</span><span class="z-punctuation z-definition z-parameters z-end z-ts">)</span></span> <span class="z-meta z-block z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span>
  <span class="z-keyword z-control z-flow z-ts">return</span> <span class="z-meta z-function-call z-ts"><span class="z-variable z-language z-this z-ts">this</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-entity z-name z-function z-ts">unsafePerformIO</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
<span class="z-punctuation z-definition z-block z-ts">}</span></span></span>
</span></code></pre><p>åŒæ ·æ˜¯ç®€å•åœ°ç§»é™¤äº†ä¸€å±‚å®¹å™¨ã€‚æ³¨æ„ï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰æåŠçº¯ç²¹æ€§çš„é—®é¢˜ï¼Œä»…ä»…æ˜¯ç§»é™¤è¿‡åº¦ç´§ç¼©çš„åŒ…è£¹ä¸­çš„ä¸€å±‚è€Œå·²ã€‚<pre class="language-js z-code" data-lang=js><code class=language-js data-lang=js><span class="z-source z-ts"><span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts">  log :: a -> IO a</span>
<span class="z-meta z-var z-expr z-ts"><span class="z-storage z-type z-ts">var</span> <span class="z-meta z-var-single-variable z-expr z-ts"><span class="z-meta z-definition z-variable z-ts"><span class="z-entity z-name z-function z-ts">log</span></span> </span><span class="z-keyword z-operator z-assignment z-ts">=</span> <span class="z-meta z-function z-expression z-ts"><span class="z-storage z-type z-function z-ts">function</span><span class="z-meta z-parameters z-ts"><span class="z-punctuation z-definition z-parameters z-begin z-ts">(</span><span class="z-variable z-parameter z-ts">x</span><span class="z-punctuation z-definition z-parameters z-end z-ts">)</span></span> <span class="z-meta z-block z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span>
  <span class="z-keyword z-control z-flow z-ts">return</span> <span class="z-new z-expr z-ts"><span class="z-keyword z-operator z-new z-ts">new</span> <span class="z-entity z-name z-type z-ts">IO</span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-function z-expression z-ts"><span class="z-storage z-type z-function z-ts">function</span><span class="z-meta z-parameters z-ts"><span class="z-punctuation z-definition z-parameters z-begin z-ts">(</span><span class="z-punctuation z-definition z-parameters z-end z-ts">)</span></span> <span class="z-meta z-block z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span> <span class="z-meta z-function-call z-ts"><span class="z-support z-class z-console z-ts">console</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-support z-function z-console z-ts">log</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-variable z-other z-readwrite z-ts">x</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-terminator z-statement z-ts">;</span> <span class="z-keyword z-control z-flow z-ts">return</span> <span class="z-variable z-other z-readwrite z-ts">x</span><span class="z-punctuation z-terminator z-statement z-ts">;</span> <span class="z-punctuation z-definition z-block z-ts">}</span></span></span><span class="z-meta z-brace z-round z-ts">)</span></span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
<span class="z-punctuation z-definition z-block z-ts">}</span></span></span></span>

<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts">  setStyle :: Selector -> CSSProps -> IO DOM</span>
<span class="z-meta z-var z-expr z-ts"><span class="z-storage z-type z-ts">var</span> <span class="z-meta z-var-single-variable z-expr z-ts"><span class="z-meta z-definition z-variable z-ts"><span class="z-variable z-other z-readwrite z-ts">setStyle</span></span> </span><span class="z-keyword z-operator z-assignment z-ts">=</span> <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">curry</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-function z-expression z-ts"><span class="z-storage z-type z-function z-ts">function</span><span class="z-meta z-parameters z-ts"><span class="z-punctuation z-definition z-parameters z-begin z-ts">(</span><span class="z-variable z-parameter z-ts">sel</span><span class="z-punctuation z-separator z-parameter z-ts">,</span> <span class="z-variable z-parameter z-ts">props</span><span class="z-punctuation z-definition z-parameters z-end z-ts">)</span></span> <span class="z-meta z-block z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span>
  <span class="z-keyword z-control z-flow z-ts">return</span> <span class="z-new z-expr z-ts"><span class="z-keyword z-operator z-new z-ts">new</span> <span class="z-entity z-name z-type z-ts">IO</span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-function z-expression z-ts"><span class="z-storage z-type z-function z-ts">function</span><span class="z-meta z-parameters z-ts"><span class="z-punctuation z-definition z-parameters z-begin z-ts">(</span><span class="z-punctuation z-definition z-parameters z-end z-ts">)</span></span> <span class="z-meta z-block z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span> <span class="z-keyword z-control z-flow z-ts">return</span> <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">jQuery</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-variable z-other z-readwrite z-ts">sel</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-meta z-function-call z-ts"><span class="z-punctuation z-accessor z-ts">.</span><span class="z-entity z-name z-function z-ts">css</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-variable z-other z-readwrite z-ts">props</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-terminator z-statement z-ts">;</span> <span class="z-punctuation z-definition z-block z-ts">}</span></span></span><span class="z-meta z-brace z-round z-ts">)</span></span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
<span class="z-punctuation z-definition z-block z-ts">}</span></span></span><span class="z-meta z-brace z-round z-ts">)</span></span><span class="z-punctuation z-terminator z-statement z-ts">;</span>

<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts">  getItem :: String -> IO String</span>
<span class="z-meta z-var z-expr z-ts"><span class="z-storage z-type z-ts">var</span> <span class="z-meta z-var-single-variable z-expr z-ts"><span class="z-meta z-definition z-variable z-ts"><span class="z-entity z-name z-function z-ts">getItem</span></span> </span><span class="z-keyword z-operator z-assignment z-ts">=</span> <span class="z-meta z-function z-expression z-ts"><span class="z-storage z-type z-function z-ts">function</span><span class="z-meta z-parameters z-ts"><span class="z-punctuation z-definition z-parameters z-begin z-ts">(</span><span class="z-variable z-parameter z-ts">key</span><span class="z-punctuation z-definition z-parameters z-end z-ts">)</span></span> <span class="z-meta z-block z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span>
  <span class="z-keyword z-control z-flow z-ts">return</span> <span class="z-new z-expr z-ts"><span class="z-keyword z-operator z-new z-ts">new</span> <span class="z-entity z-name z-type z-ts">IO</span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-function z-expression z-ts"><span class="z-storage z-type z-function z-ts">function</span><span class="z-meta z-parameters z-ts"><span class="z-punctuation z-definition z-parameters z-begin z-ts">(</span><span class="z-punctuation z-definition z-parameters z-end z-ts">)</span></span> <span class="z-meta z-block z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span> <span class="z-keyword z-control z-flow z-ts">return</span> <span class="z-meta z-function-call z-ts"><span class="z-variable z-other z-object z-ts">localStorage</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-support z-function z-dom z-ts">getItem</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-variable z-other z-readwrite z-ts">key</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-terminator z-statement z-ts">;</span> <span class="z-punctuation z-definition z-block z-ts">}</span></span></span><span class="z-meta z-brace z-round z-ts">)</span></span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
<span class="z-punctuation z-definition z-block z-ts">}</span></span></span></span><span class="z-punctuation z-terminator z-statement z-ts">;</span>

<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts">  applyPreferences :: String -> IO DOM</span>
<span class="z-meta z-var z-expr z-ts"><span class="z-storage z-type z-ts">var</span> <span class="z-meta z-var-single-variable z-expr z-ts"><span class="z-meta z-definition z-variable z-ts"><span class="z-variable z-other z-readwrite z-ts">applyPreferences</span></span> </span><span class="z-keyword z-operator z-assignment z-ts">=</span> <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">compose</span></span><span class="z-meta z-brace z-round z-ts">(</span>
  <span class="z-variable z-other z-readwrite z-ts">join</span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">map</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">setStyle</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-string z-quoted z-single z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">'</span>#main<span class="z-punctuation z-definition z-string z-end z-ts">'</span></span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-variable z-other z-readwrite z-ts">join</span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">map</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-variable z-other z-readwrite z-ts">log</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">map</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-support z-constant z-json z-ts">JSON</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-support z-function z-json z-ts">parse</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-variable z-other z-readwrite z-ts">getItem</span>
<span class="z-meta z-brace z-round z-ts">)</span></span><span class="z-punctuation z-terminator z-statement z-ts">;</span>


<span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">applyPreferences</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-string z-quoted z-single z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">'</span>preferences<span class="z-punctuation z-definition z-string z-end z-ts">'</span></span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-meta z-function-call z-ts"><span class="z-punctuation z-accessor z-ts">.</span><span class="z-entity z-name z-function z-ts">unsafePerformIO</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts"> Object {backgroundColor: "green"}</span>
<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts"> &LTdiv style="background-color: 'green'"/></span>
</span></code></pre><p><code>getItem</code> è¿”å›äº†ä¸€ä¸ª <code>IO String</code>ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ç”¨ <code>map</code> æ¥è§£æå®ƒã€‚<code>log</code> å’Œ <code>setStyle</code> è¿”å›çš„éƒ½æ˜¯ <code>IO</code>ï¼Œæ‰€ä»¥å¿…é¡»è¦ä½¿ç”¨ <code>join</code> æ¥ä¿è¯è¿™é‡Œè¾¹çš„åµŒå¥—å¤„äºæ§åˆ¶ä¹‹ä¸­ã€‚<h2 id=chain-han-shu>chain å‡½æ•°<a aria-label="Anchor link for: chain-han-shu" class=zola-anchor href=#chain-han-shu style=visibility:hidden>#</a></h2><p>ï¼ˆè¯‘è€…æ³¨ï¼šæ­¤å¤„æ ‡é¢˜åŸæ–‡æ˜¯â€œMy chain hits my chestâ€ï¼Œæ˜¯è‹±å›½æ­Œæ‰‹ M.I.A å•æ›² <em>Bad Girls</em> çš„ä¸€å¥æ­Œè¯ã€‚æ®è¯´è¿™é¦–æ­Œæœ‰ä½“ç°å¥³æƒä¸»ä¹‰ã€‚ï¼‰<figure><img alt=chain src=https://shankun.github.io/img/chain.jpg></figure><p>ä½ å¯èƒ½å·²ç»ä»ä¸Šé¢çš„ä¾‹å­ä¸­æ³¨æ„åˆ°è¿™ç§æ¨¡å¼äº†ï¼šæˆ‘ä»¬æ€»æ˜¯åœ¨ç´§è·Ÿç€ <code>map</code> çš„åé¢è°ƒç”¨ <code>join</code>ã€‚è®©æˆ‘ä»¬æŠŠè¿™ä¸ªè¡Œä¸ºæŠ½è±¡åˆ°ä¸€ä¸ªå«åš <code>chain</code> çš„å‡½æ•°é‡Œã€‚<pre class="language-js z-code" data-lang=js><code class=language-js data-lang=js><span class="z-source z-ts"><span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts">  chain :: Monad m => (a -> m b) -> m a -> m b</span>
<span class="z-meta z-var z-expr z-ts"><span class="z-storage z-type z-ts">var</span> <span class="z-meta z-var-single-variable z-expr z-ts"><span class="z-meta z-definition z-variable z-ts"><span class="z-variable z-other z-readwrite z-ts">chain</span></span> </span><span class="z-keyword z-operator z-assignment z-ts">=</span> <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">curry</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-function z-expression z-ts"><span class="z-storage z-type z-function z-ts">function</span><span class="z-meta z-parameters z-ts"><span class="z-punctuation z-definition z-parameters z-begin z-ts">(</span><span class="z-variable z-parameter z-ts">f</span><span class="z-punctuation z-separator z-parameter z-ts">,</span> <span class="z-variable z-parameter z-ts">m</span><span class="z-punctuation z-definition z-parameters z-end z-ts">)</span></span><span class="z-meta z-block z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span>
  <span class="z-keyword z-control z-flow z-ts">return</span> <span class="z-meta z-function-call z-ts"><span class="z-variable z-other z-object z-ts">m</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-entity z-name z-function z-ts">map</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-variable z-other z-readwrite z-ts">f</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-meta z-function-call z-ts"><span class="z-punctuation z-accessor z-ts">.</span><span class="z-support z-function z-ts">join</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-terminator z-statement z-ts">;</span> <span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts"> æˆ–è€… compose(join, map(f))(m)</span>
<span class="z-punctuation z-definition z-block z-ts">}</span></span></span><span class="z-meta z-brace z-round z-ts">)</span></span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
</span></code></pre><p>è¿™é‡Œä»…ä»…æ˜¯æŠŠ map/join å¥—é¤æ‰“åŒ…åˆ°ä¸€ä¸ªå•ç‹¬çš„å‡½æ•°ä¸­ã€‚å¦‚æœä½ ä¹‹å‰äº†è§£è¿‡ monadï¼Œé‚£ä½ å¯èƒ½å·²ç»çœ‹å‡ºæ¥ <code>chain</code> å«åš <code>>>=</code>ï¼ˆè¯»ä½œ bindï¼‰æˆ–è€… <code>flatMap</code>ï¼›éƒ½æ˜¯åŒä¸€ä¸ªæ¦‚å¿µçš„ä¸åŒåç§°ç½¢äº†ã€‚æˆ‘ä¸ªäººè®¤ä¸º <code>flatMap</code> æ˜¯æœ€å‡†ç¡®çš„åç§°ï¼Œä½†æœ¬ä¹¦è¿˜æ˜¯åšæŒä½¿ç”¨ <code>chain</code>ï¼Œå› ä¸ºå®ƒæ˜¯ JS é‡Œæ¥å—ç¨‹åº¦æœ€é«˜çš„ä¸€ä¸ªã€‚æˆ‘ä»¬ç”¨ <code>chain</code> é‡æ„ä¸‹ä¸Šé¢ä¸¤ä¸ªä¾‹å­ï¼š<pre class="language-js z-code" data-lang=js><code class=language-js data-lang=js><span class="z-source z-ts"><span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts"> map/join</span>
<span class="z-meta z-var z-expr z-ts"><span class="z-storage z-type z-ts">var</span> <span class="z-meta z-var-single-variable z-expr z-ts"><span class="z-meta z-definition z-variable z-ts"><span class="z-variable z-other z-readwrite z-ts">firstAddressStreet</span></span> </span><span class="z-keyword z-operator z-assignment z-ts">=</span> <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">compose</span></span><span class="z-meta z-brace z-round z-ts">(</span>
  <span class="z-variable z-other z-readwrite z-ts">join</span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">map</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">safeProp</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-string z-quoted z-single z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">'</span>street<span class="z-punctuation z-definition z-string z-end z-ts">'</span></span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-variable z-other z-readwrite z-ts">join</span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">map</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-variable z-other z-readwrite z-ts">safeHead</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">safeProp</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-string z-quoted z-single z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">'</span>addresses<span class="z-punctuation z-definition z-string z-end z-ts">'</span></span><span class="z-meta z-brace z-round z-ts">)</span>
<span class="z-meta z-brace z-round z-ts">)</span></span><span class="z-punctuation z-terminator z-statement z-ts">;</span>

<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts"> chain</span>
<span class="z-meta z-var z-expr z-ts"><span class="z-storage z-type z-ts">var</span> <span class="z-meta z-var-single-variable z-expr z-ts"><span class="z-meta z-definition z-variable z-ts"><span class="z-variable z-other z-readwrite z-ts">firstAddressStreet</span></span> </span><span class="z-keyword z-operator z-assignment z-ts">=</span> <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">compose</span></span><span class="z-meta z-brace z-round z-ts">(</span>
  <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">chain</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">safeProp</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-string z-quoted z-single z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">'</span>street<span class="z-punctuation z-definition z-string z-end z-ts">'</span></span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">chain</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-variable z-other z-readwrite z-ts">safeHead</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">safeProp</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-string z-quoted z-single z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">'</span>addresses<span class="z-punctuation z-definition z-string z-end z-ts">'</span></span><span class="z-meta z-brace z-round z-ts">)</span>
<span class="z-meta z-brace z-round z-ts">)</span></span><span class="z-punctuation z-terminator z-statement z-ts">;</span>



<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts"> map/join</span>
<span class="z-meta z-var z-expr z-ts"><span class="z-storage z-type z-ts">var</span> <span class="z-meta z-var-single-variable z-expr z-ts"><span class="z-meta z-definition z-variable z-ts"><span class="z-variable z-other z-readwrite z-ts">applyPreferences</span></span> </span><span class="z-keyword z-operator z-assignment z-ts">=</span> <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">compose</span></span><span class="z-meta z-brace z-round z-ts">(</span>
  <span class="z-variable z-other z-readwrite z-ts">join</span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">map</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">setStyle</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-string z-quoted z-single z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">'</span>#main<span class="z-punctuation z-definition z-string z-end z-ts">'</span></span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-variable z-other z-readwrite z-ts">join</span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">map</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-variable z-other z-readwrite z-ts">log</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">map</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-support z-constant z-json z-ts">JSON</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-support z-function z-json z-ts">parse</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-variable z-other z-readwrite z-ts">getItem</span>
<span class="z-meta z-brace z-round z-ts">)</span></span><span class="z-punctuation z-terminator z-statement z-ts">;</span>

<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts"> chain</span>
<span class="z-meta z-var z-expr z-ts"><span class="z-storage z-type z-ts">var</span> <span class="z-meta z-var-single-variable z-expr z-ts"><span class="z-meta z-definition z-variable z-ts"><span class="z-variable z-other z-readwrite z-ts">applyPreferences</span></span> </span><span class="z-keyword z-operator z-assignment z-ts">=</span> <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">compose</span></span><span class="z-meta z-brace z-round z-ts">(</span>
  <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">chain</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">setStyle</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-string z-quoted z-single z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">'</span>#main<span class="z-punctuation z-definition z-string z-end z-ts">'</span></span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">chain</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-variable z-other z-readwrite z-ts">log</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">map</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-support z-constant z-json z-ts">JSON</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-support z-function z-json z-ts">parse</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-variable z-other z-readwrite z-ts">getItem</span>
<span class="z-meta z-brace z-round z-ts">)</span></span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
</span></code></pre><p>æˆ‘æŠŠæ‰€æœ‰çš„ <code>map/join</code> éƒ½æ›¿æ¢ä¸ºäº† <code>chain</code>ï¼Œè¿™æ ·ä»£ç å°±æ˜¾å¾—æ•´æ´äº†äº›ã€‚æ•´æ´å›ºç„¶æ˜¯å¥½äº‹ï¼Œä½† <code>chain</code> çš„èƒ½åŠ›å´ä¸æ­¢äºæ­¤â€”â€”å®ƒæ›´å¤šçš„æ˜¯é¾™å·é£è€Œä¸æ˜¯å¸å°˜å™¨ã€‚å› ä¸º <code>chain</code> å¯ä»¥è½»æ¾åœ°åµŒå¥—å¤šä¸ªä½œç”¨ï¼Œå› æ­¤æˆ‘ä»¬å°±èƒ½ä»¥ä¸€ç§çº¯å‡½æ•°å¼çš„æ–¹å¼æ¥è¡¨ç¤º <em>åºåˆ—</em>ï¼ˆsequenceï¼‰ å’Œ <em>å˜é‡èµ‹å€¼</em>ï¼ˆvariable assignmentï¼‰ã€‚<pre class="language-js z-code" data-lang=js><code class=language-js data-lang=js><span class="z-source z-ts"><span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts"> getJSON :: Url -> Params -> Task JSON</span>
<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts"> querySelector :: Selector -> IO DOM</span>


<span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">getJSON</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-string z-quoted z-single z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">'</span>/authenticate<span class="z-punctuation z-definition z-string z-end z-ts">'</span></span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-meta z-objectliteral z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span><span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts">username</span></span><span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts"><span class="z-punctuation z-separator z-key-value z-ts">:</span></span> <span class="z-string z-quoted z-single z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">'</span>stale<span class="z-punctuation z-definition z-string z-end z-ts">'</span></span></span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts">password</span></span><span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts"><span class="z-punctuation z-separator z-key-value z-ts">:</span></span> <span class="z-string z-quoted z-single z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">'</span>crackers<span class="z-punctuation z-definition z-string z-end z-ts">'</span></span></span><span class="z-punctuation z-definition z-block z-ts">}</span></span><span class="z-meta z-brace z-round z-ts">)</span>
  <span class="z-meta z-function-call z-ts"><span class="z-punctuation z-accessor z-ts">.</span><span class="z-entity z-name z-function z-ts">chain</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-function z-expression z-ts"><span class="z-storage z-type z-function z-ts">function</span><span class="z-meta z-parameters z-ts"><span class="z-punctuation z-definition z-parameters z-begin z-ts">(</span><span class="z-variable z-parameter z-ts">user</span><span class="z-punctuation z-definition z-parameters z-end z-ts">)</span></span> <span class="z-meta z-block z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span>
    <span class="z-keyword z-control z-flow z-ts">return</span> <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">getJSON</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-string z-quoted z-single z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">'</span>/friends<span class="z-punctuation z-definition z-string z-end z-ts">'</span></span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-meta z-objectliteral z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span><span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts">user_id</span></span><span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts"><span class="z-punctuation z-separator z-key-value z-ts">:</span></span> <span class="z-variable z-other z-object z-ts">user</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-support z-variable z-property z-dom z-ts">id</span></span><span class="z-punctuation z-definition z-block z-ts">}</span></span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
<span class="z-punctuation z-definition z-block z-ts">}</span></span></span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts"> Task([{name: 'Seimith', id: 14}, {name: 'Ric', id: 39}]);</span>


<span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">querySelector</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-string z-quoted z-double z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">"</span>input.username<span class="z-punctuation z-definition z-string z-end z-ts">"</span></span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-meta z-function-call z-ts"><span class="z-punctuation z-accessor z-ts">.</span><span class="z-entity z-name z-function z-ts">chain</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-function z-expression z-ts"><span class="z-storage z-type z-function z-ts">function</span><span class="z-meta z-parameters z-ts"><span class="z-punctuation z-definition z-parameters z-begin z-ts">(</span><span class="z-variable z-parameter z-ts">uname</span><span class="z-punctuation z-definition z-parameters z-end z-ts">)</span></span> <span class="z-meta z-block z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span>
  <span class="z-keyword z-control z-flow z-ts">return</span> <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">querySelector</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-string z-quoted z-double z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">"</span>input.email<span class="z-punctuation z-definition z-string z-end z-ts">"</span></span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-meta z-function-call z-ts"><span class="z-punctuation z-accessor z-ts">.</span><span class="z-entity z-name z-function z-ts">chain</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-function z-expression z-ts"><span class="z-storage z-type z-function z-ts">function</span><span class="z-meta z-parameters z-ts"><span class="z-punctuation z-definition z-parameters z-begin z-ts">(</span><span class="z-variable z-parameter z-ts">email</span><span class="z-punctuation z-definition z-parameters z-end z-ts">)</span></span> <span class="z-meta z-block z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span>
    <span class="z-keyword z-control z-flow z-ts">return</span> <span class="z-meta z-function-call z-ts"><span class="z-variable z-other z-constant z-object z-ts">IO</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-entity z-name z-function z-ts">of</span></span><span class="z-meta z-brace z-round z-ts">(</span>
      <span class="z-string z-quoted z-double z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">"</span>Welcome <span class="z-punctuation z-definition z-string z-end z-ts">"</span></span> <span class="z-keyword z-operator z-arithmetic z-ts">+</span> <span class="z-variable z-other z-object z-ts">uname</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-support z-variable z-property z-dom z-ts">value</span> <span class="z-keyword z-operator z-arithmetic z-ts">+</span> <span class="z-string z-quoted z-double z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">"</span> <span class="z-punctuation z-definition z-string z-end z-ts">"</span></span> <span class="z-keyword z-operator z-arithmetic z-ts">+</span> <span class="z-string z-quoted z-double z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">"</span>prepare for spam at <span class="z-punctuation z-definition z-string z-end z-ts">"</span></span> <span class="z-keyword z-operator z-arithmetic z-ts">+</span> <span class="z-variable z-other z-object z-ts">email</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-support z-variable z-property z-dom z-ts">value</span>
    <span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
  <span class="z-punctuation z-definition z-block z-ts">}</span></span></span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
<span class="z-punctuation z-definition z-block z-ts">}</span></span></span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts"> IO("Welcome Olivia prepare for spam at olivia@tremorcontrol.net");</span>


<span class="z-meta z-function-call z-ts"><span class="z-variable z-other z-object z-ts">Maybe</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-entity z-name z-function z-ts">of</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-constant z-numeric z-decimal z-ts">3</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-meta z-function-call z-ts"><span class="z-punctuation z-accessor z-ts">.</span><span class="z-entity z-name z-function z-ts">chain</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-function z-expression z-ts"><span class="z-storage z-type z-function z-ts">function</span><span class="z-meta z-parameters z-ts"><span class="z-punctuation z-definition z-parameters z-begin z-ts">(</span><span class="z-variable z-parameter z-ts">three</span><span class="z-punctuation z-definition z-parameters z-end z-ts">)</span></span> <span class="z-meta z-block z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span>
  <span class="z-keyword z-control z-flow z-ts">return</span> <span class="z-meta z-function-call z-ts"><span class="z-variable z-other z-object z-ts">Maybe</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-entity z-name z-function z-ts">of</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-constant z-numeric z-decimal z-ts">2</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-meta z-function-call z-ts"><span class="z-punctuation z-accessor z-ts">.</span><span class="z-entity z-name z-function z-ts">map</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">add</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-variable z-other z-readwrite z-ts">three</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
<span class="z-punctuation z-definition z-block z-ts">}</span></span></span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts"> Maybe(5);</span>


<span class="z-meta z-function-call z-ts"><span class="z-variable z-other z-object z-ts">Maybe</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-entity z-name z-function z-ts">of</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-constant z-language z-null z-ts">null</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-meta z-function-call z-ts"><span class="z-punctuation z-accessor z-ts">.</span><span class="z-entity z-name z-function z-ts">chain</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">safeProp</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-string z-quoted z-single z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">'</span>address<span class="z-punctuation z-definition z-string z-end z-ts">'</span></span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-meta z-function-call z-ts"><span class="z-punctuation z-accessor z-ts">.</span><span class="z-entity z-name z-function z-ts">chain</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">safeProp</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-string z-quoted z-single z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">'</span>street<span class="z-punctuation z-definition z-string z-end z-ts">'</span></span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts"> Maybe(null);</span>
</span></code></pre><p>æœ¬æ¥æˆ‘ä»¬å¯ä»¥ç”¨ <code>compose</code> å†™ä¸Šé¢çš„ä¾‹å­ï¼Œä½†è¿™å°†éœ€è¦å‡ ä¸ªå¸®åŠ©å‡½æ•°ï¼Œè€Œä¸”è¿™ç§é£æ ¼æ€ä¹ˆè¯´éƒ½è¦é€šè¿‡é—­åŒ…è¿›è¡Œæ˜ç¡®çš„å˜é‡èµ‹å€¼ã€‚ç›¸åï¼Œæˆ‘ä»¬ä½¿ç”¨äº†æ’å…¥å¼çš„ <code>chain</code>ã€‚é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œ<code>chain</code> å¯ä»¥è‡ªåŠ¨ä»ä»»æ„ç±»å‹çš„ <code>map</code> å’Œ <code>join</code> è¡ç”Ÿå‡ºæ¥ï¼Œå°±åƒè¿™æ ·ï¼š<code>t.prototype.chain = function(f) { return this.map(f).join(); }</code>ã€‚å¦‚æœæ‰‹åŠ¨å®šä¹‰ <code>chain</code> èƒ½è®©ä½ è§‰å¾—æ€§èƒ½ä¼šå¥½ç‚¹çš„è¯ï¼ˆå®é™…ä¸Šå¹¶ä¸ä¼šï¼‰ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨å®šä¹‰å®ƒï¼Œå°½ç®¡è¿˜å¿…é¡»è¦è´¹åŠ›ä¿è¯å‡½æ•°åŠŸèƒ½çš„æ­£ç¡®æ€§â€”â€”ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒå¿…é¡»ä¸ç´§æ¥ç€åé¢æœ‰ <code>join</code> çš„ <code>map</code> ç›¸ç­‰ã€‚å¦‚æœ <code>chain</code> æ˜¯ç®€å•åœ°é€šè¿‡ç»“æŸè°ƒç”¨ <code>of</code> åæŠŠå€¼æ”¾å›å®¹å™¨è¿™ç§æ–¹å¼å®šä¹‰çš„ï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆä¸€ä¸ªæœ‰è¶£çš„åæœï¼Œå³å¯ä»¥ä» <code>chain</code> é‚£é‡Œè¡ç”Ÿå‡ºä¸€ä¸ª <code>map</code>ã€‚åŒæ ·åœ°ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç”¨ <code>chain(id)</code> å®šä¹‰ <code>join</code>ã€‚å¬èµ·æ¥å¥½åƒæ˜¯åœ¨è·Ÿé­”æœ¯å¸ˆç©å¾·å·æ‰‘å…‹ï¼Œé­”æœ¯å¸ˆæƒ³è¦ä»€ä¹ˆç‰Œå°±æœ‰ä»€ä¹ˆç‰Œï¼›ä½†æ˜¯å°±åƒå¤§éƒ¨åˆ†çš„æ•°å­¦ç†è®ºä¸€æ ·ï¼Œæ‰€æœ‰è¿™äº›åŸåˆ™æ€§çš„ç»“æ„éƒ½æ˜¯ç›¸äº’å…³è”çš„ã€‚<a rel="nofollow noreferrer" href=https://github.com/fantasyland/fantasy-land>fantasyland</a> ä»“åº“ä¸­æåˆ°äº†è®¸å¤šä¸Šè¿°è¡ç”Ÿæ¦‚å¿µï¼Œè¿™ä¸ªä»“åº“ä¹Ÿæ˜¯ JavaScript å®˜æ–¹çš„ä»£æ•°æ•°æ®ç»“æ„ï¼ˆalgebraic data typesï¼‰æ ‡å‡†ã€‚<p>å¥½äº†ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸Šé¢çš„ä¾‹å­ã€‚ç¬¬ä¸€ä¸ªä¾‹å­ä¸­ï¼Œå¯ä»¥çœ‹åˆ°ä¸¤ä¸ª <code>Task</code> é€šè¿‡ <code>chain</code> è¿æ¥å½¢æˆäº†ä¸€ä¸ªå¼‚æ­¥æ“ä½œçš„åºåˆ—â€”â€”å®ƒå…ˆè·å– <code>user</code>ï¼Œç„¶åç”¨ <code>user.id</code> æŸ¥æ‰¾ <code>user</code> çš„ <code>friends</code>ã€‚<code>chain</code> é¿å…äº† <code>Task(Task([Friend]))</code> è¿™ç§æƒ…å†µã€‚<p>ç¬¬äºŒä¸ªä¾‹å­æ˜¯ç”¨ <code>querySelector</code> æŸ¥æ‰¾å‡ ä¸ª input ç„¶ååˆ›å»ºä¸€æ¡æ¬¢è¿ä¿¡æ¯ã€‚æ³¨æ„çœ‹æˆ‘ä»¬æ˜¯å¦‚ä½•åœ¨æœ€å†…å±‚çš„å‡½æ•°é‡Œè®¿é—® <code>uname</code> å’Œ <code>email</code> çš„â€”â€”è¿™æ˜¯å‡½æ•°å¼å˜é‡èµ‹å€¼çš„ç»ä½³è¡¨ç°ã€‚å› ä¸º <code>IO</code> å¤§æ–¹åœ°æŠŠå®ƒçš„å€¼å€Ÿç»™äº†æˆ‘ä»¬ï¼Œæˆ‘ä»¬ä¹Ÿè¦è´Ÿèµ·ä»¥åŒæ ·æ–¹å¼æŠŠå€¼æ”¾å›å»çš„è´£ä»»â€”â€”ä¸èƒ½è¾œè´Ÿå®ƒçš„ä¿¡ä»»ï¼ˆè¿˜æœ‰æ•´ä¸ªç¨‹åºçš„ä¿¡ä»»ï¼‰ã€‚<code>IO.of</code> éå¸¸é€‚åˆåšè¿™ä»¶äº‹ï¼ŒåŒæ—¶å®ƒä¹Ÿè§£é‡Šäº†ä¸ºä½• pointed è¿™ä¸€ç‰¹æ€§æ˜¯ monad æ¥å£å¾—ä»¥å­˜åœ¨çš„é‡è¦å‰æã€‚ä¸è¿‡ï¼Œ<code>map</code> ä¹Ÿèƒ½è¿”å›æ­£ç¡®çš„ç±»å‹ï¼š<pre class="language-js z-code" data-lang=js><code class=language-js data-lang=js><span class="z-source z-ts"><span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">querySelector</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-string z-quoted z-double z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">"</span>input.username<span class="z-punctuation z-definition z-string z-end z-ts">"</span></span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-meta z-function-call z-ts"><span class="z-punctuation z-accessor z-ts">.</span><span class="z-entity z-name z-function z-ts">chain</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-function z-expression z-ts"><span class="z-storage z-type z-function z-ts">function</span><span class="z-meta z-parameters z-ts"><span class="z-punctuation z-definition z-parameters z-begin z-ts">(</span><span class="z-variable z-parameter z-ts">uname</span><span class="z-punctuation z-definition z-parameters z-end z-ts">)</span></span> <span class="z-meta z-block z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span>
  <span class="z-keyword z-control z-flow z-ts">return</span> <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">querySelector</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-string z-quoted z-double z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">"</span>input.email<span class="z-punctuation z-definition z-string z-end z-ts">"</span></span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-meta z-function-call z-ts"><span class="z-punctuation z-accessor z-ts">.</span><span class="z-entity z-name z-function z-ts">map</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-function z-expression z-ts"><span class="z-storage z-type z-function z-ts">function</span><span class="z-meta z-parameters z-ts"><span class="z-punctuation z-definition z-parameters z-begin z-ts">(</span><span class="z-variable z-parameter z-ts">email</span><span class="z-punctuation z-definition z-parameters z-end z-ts">)</span></span> <span class="z-meta z-block z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span>
    <span class="z-keyword z-control z-flow z-ts">return</span> <span class="z-string z-quoted z-double z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">"</span>Welcome <span class="z-punctuation z-definition z-string z-end z-ts">"</span></span> <span class="z-keyword z-operator z-arithmetic z-ts">+</span> <span class="z-variable z-other z-object z-ts">uname</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-support z-variable z-property z-dom z-ts">value</span> <span class="z-keyword z-operator z-arithmetic z-ts">+</span> <span class="z-string z-quoted z-double z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">"</span> prepare for spam at <span class="z-punctuation z-definition z-string z-end z-ts">"</span></span> <span class="z-keyword z-operator z-arithmetic z-ts">+</span> <span class="z-variable z-other z-object z-ts">email</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-support z-variable z-property z-dom z-ts">value</span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
  <span class="z-punctuation z-definition z-block z-ts">}</span></span></span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
<span class="z-punctuation z-definition z-block z-ts">}</span></span></span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts"> IO("Welcome Olivia prepare for spam at olivia@tremorcontrol.net");</span>
</span></code></pre><p>æœ€åä¸¤ä¸ªä¾‹å­ç”¨äº† <code>Maybe</code>ã€‚å› ä¸º <code>chain</code> å…¶å®æ˜¯åœ¨åº•å±‚è°ƒç”¨äº† <code>map</code>ï¼Œæ‰€ä»¥å¦‚æœé‡åˆ° <code>null</code>ï¼Œä»£ç å°±ä¼šç«‹åˆ»åœæ­¢è¿è¡Œã€‚<p>å¦‚æœè§‰å¾—è¿™äº›ä¾‹å­ä¸å¤ªå®¹æ˜“ç†è§£ï¼Œä½ ä¹Ÿä¸å¿…æ‹…å¿ƒã€‚å¤šè·‘è·‘ä»£ç ï¼Œå¤šç¢ç£¨ç¢ç£¨ï¼ŒæŠŠä»£ç æ‹†å¼€æ¥ç ”ç©¶ç ”ç©¶ï¼Œå†æŠŠå®ƒä»¬æ‹¼èµ·æ¥çœ‹çœ‹ã€‚æ€»ä¹‹è®°ä½ï¼Œè¿”å›çš„å¦‚æœæ˜¯â€œæ™®é€šâ€å€¼å°±ç”¨ <code>map</code>ï¼Œå¦‚æœæ˜¯ <code>functor</code> å°±ç”¨ <code>chain</code>ã€‚<p>è¿™é‡Œæˆ‘å¾—æé†’ä¸€ä¸‹ï¼Œä¸Šè¿°æ–¹å¼å¯¹ä¸¤ä¸ªä¸åŒç±»å‹çš„åµŒå¥—å®¹å™¨æ˜¯ä¸é€‚ç”¨çš„ã€‚functor ç»„åˆï¼Œä»¥åŠåé¢ä¼šè®²åˆ°çš„ monad transformer å¯ä»¥å¸®åŠ©æˆ‘ä»¬åº”å¯¹è¿™ç§æƒ…å†µã€‚<h2 id=xuan-yao>ç‚«è€€<a aria-label="Anchor link for: xuan-yao" class=zola-anchor href=#xuan-yao style=visibility:hidden>#</a></h2><p>è¿™ç§å®¹å™¨ç¼–ç¨‹é£æ ¼æœ‰æ—¶ä¹Ÿèƒ½é€ æˆå›°æƒ‘ï¼Œæˆ‘ä»¬ä¸å¾—ä¸åŠªåŠ›ç†è§£ä¸€ä¸ªå€¼åˆ°åº•åµŒå¥—äº†å‡ å±‚å®¹å™¨ï¼Œæˆ–è€…éœ€è¦ç”¨ <code>map</code> è¿˜æ˜¯ <code>chain</code>ï¼ˆå¾ˆå¿«æˆ‘ä»¬å°±ä¼šè®¤è¯†æ›´å¤šçš„å®¹å™¨ç±»å‹ï¼‰ã€‚ä½¿ç”¨ä¸€äº›æŠ€å·§ï¼Œæ¯”å¦‚é‡å†™ <code>inspect</code> æ–¹æ³•ä¹‹ç±»ï¼Œèƒ½å¤Ÿå¤§å¹…æé«˜ debug çš„æ•ˆç‡ã€‚åé¢æˆ‘ä»¬ä¹Ÿä¼šå­¦ä¹ å¦‚ä½•åˆ›å»ºä¸€ä¸ªâ€œæ ˆâ€ï¼Œä½¿ä¹‹èƒ½å¤Ÿå¤„ç†ä»»ä½•ä¸¢ç»™å®ƒçš„ä½œç”¨ï¼ˆeffectsï¼‰ã€‚ä¸è¿‡ï¼Œæœ‰æ—¶å€™ä¹Ÿéœ€è¦æƒè¡¡ä¸€ä¸‹æ˜¯å¦å€¼å¾—è¿™æ ·åšã€‚<p>æˆ‘å¾ˆä¹æ„æŒ¥èµ· monad ä¹‹å‰‘ï¼Œå‘ä½ å±•ç¤ºè¿™ç§ç¼–ç¨‹é£æ ¼çš„åŠ›é‡ã€‚å°±ä»¥è¯»ä¸€ä¸ªæ–‡ä»¶ï¼Œç„¶åå°±æŠŠå®ƒç›´æ¥ä¸Šä¼ ä¸ºä¾‹å§ï¼š<pre class="language-js z-code" data-lang=js><code class=language-js data-lang=js><span class="z-source z-ts"><span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts"> readFile :: Filename -> Either String (Future Error String)</span>
<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts"> httpPost :: String -> Future Error JSON</span>

<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts">  upload :: String -> Either String (Future Error JSON)</span>
<span class="z-meta z-var z-expr z-ts"><span class="z-storage z-type z-ts">var</span> <span class="z-meta z-var-single-variable z-expr z-ts"><span class="z-meta z-definition z-variable z-ts"><span class="z-variable z-other z-readwrite z-ts">upload</span></span> </span><span class="z-keyword z-operator z-assignment z-ts">=</span> <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">compose</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">map</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">chain</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">httpPost</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-string z-quoted z-single z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">'</span>/uploads<span class="z-punctuation z-definition z-string z-end z-ts">'</span></span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-variable z-other z-readwrite z-ts">readFile</span><span class="z-meta z-brace z-round z-ts">)</span></span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
</span></code></pre><p>è¿™é‡Œï¼Œä»£ç ä¸æ­¢ä¸€æ¬¡åœ¨ä¸åŒçš„åˆ†æ”¯æ‰§è¡Œã€‚ä»ç±»å‹ç­¾åå¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬é¢„é˜²äº†ä¸‰ä¸ªé”™è¯¯â€”â€”<code>readFile</code> ä½¿ç”¨ <code>Either</code> æ¥éªŒè¯è¾“å…¥ï¼ˆæˆ–è®¸è¿˜æœ‰ç¡®ä¿æ–‡ä»¶åå­˜åœ¨ï¼‰ï¼›<code>readFile</code> åœ¨è¯»å–æ–‡ä»¶çš„æ—¶å€™å¯èƒ½ä¼šå‡ºé”™ï¼Œé”™è¯¯é€šè¿‡ <code>readFile</code> çš„ <code>Future</code> è¡¨ç¤ºï¼›æ–‡ä»¶ä¸Šä¼ å¯èƒ½ä¼šå› ä¸ºå„ç§å„æ ·çš„åŸå› å‡ºé”™ï¼Œé”™è¯¯é€šè¿‡ <code>httpPost</code> çš„ <code>Future</code> è¡¨ç¤ºã€‚æˆ‘ä»¬å°±è¿™ä¹ˆéšæ„åœ°ä½¿ç”¨ <code>chain</code> å®ç°äº†ä¸¤ä¸ªåµŒå¥—çš„ã€æœ‰åºçš„å¼‚æ­¥æ‰§è¡ŒåŠ¨ä½œã€‚<p>æ‰€æœ‰è¿™äº›æ“ä½œéƒ½æ˜¯åœ¨ä¸€ä¸ªä»å·¦åˆ°å³çš„çº¿æ€§æµä¸­å®Œæˆçš„ï¼Œæ˜¯å®Œå®Œå…¨å…¨çº¯çš„ã€å£°æ˜å¼çš„ä»£ç ï¼Œæ˜¯å¯ä»¥ç­‰å¼æ¨å¯¼ï¼ˆequational reasoningï¼‰å¹¶æ‹¥æœ‰å¯é ç‰¹æ€§ï¼ˆreliable propertiesï¼‰çš„ä»£ç ã€‚æˆ‘ä»¬æ²¡æœ‰è¢«è¿«ä½¿ç”¨ä¸å¿…è¦ç”šè‡³ä»¤äººå›°æƒ‘çš„å˜é‡åï¼Œæˆ‘ä»¬çš„ <code>upload</code> å‡½æ•°ç¬¦åˆé€šç”¨æ¥å£è€Œä¸æ˜¯ç‰¹å®šçš„ä¸€æ¬¡æ€§æ¥å£ã€‚è¿™äº›éƒ½æ˜¯åœ¨ä¸€è¡Œä»£ç ä¸­å®Œæˆçš„å•Šï¼<p>è®©æˆ‘ä»¬æ¥è·Ÿæ ‡å‡†çš„å‘½ä»¤å¼çš„å®ç°å¯¹æ¯”ä¸€ä¸‹ï¼š<pre class="language-js z-code" data-lang=js><code class=language-js data-lang=js><span class="z-source z-ts"><span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts">  upload :: String -> (String -> a) -> Void</span>
<span class="z-meta z-var z-expr z-ts"><span class="z-storage z-type z-ts">var</span> <span class="z-meta z-var-single-variable z-expr z-ts"><span class="z-meta z-definition z-variable z-ts"><span class="z-entity z-name z-function z-ts">upload</span></span> </span><span class="z-keyword z-operator z-assignment z-ts">=</span> <span class="z-meta z-function z-expression z-ts"><span class="z-storage z-type z-function z-ts">function</span><span class="z-meta z-parameters z-ts"><span class="z-punctuation z-definition z-parameters z-begin z-ts">(</span><span class="z-variable z-parameter z-ts">filename</span><span class="z-punctuation z-separator z-parameter z-ts">,</span> <span class="z-variable z-parameter z-ts">callback</span><span class="z-punctuation z-definition z-parameters z-end z-ts">)</span></span> <span class="z-meta z-block z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span>
  <span class="z-keyword z-control z-conditional z-ts">if</span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-keyword z-operator z-logical z-ts">!</span><span class="z-variable z-other z-readwrite z-ts">filename</span><span class="z-meta z-brace z-round z-ts">)</span> <span class="z-meta z-block z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span>
    <span class="z-keyword z-control z-trycatch z-ts">throw</span> <span class="z-string z-quoted z-double z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">"</span>You need a filename!<span class="z-punctuation z-definition z-string z-end z-ts">"</span></span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
  <span class="z-punctuation z-definition z-block z-ts">}</span></span> <span class="z-keyword z-control z-conditional z-ts">else</span> <span class="z-meta z-block z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span>
    <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">readFile</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-variable z-other z-readwrite z-ts">filename</span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-meta z-function z-expression z-ts"><span class="z-storage z-type z-function z-ts">function</span><span class="z-meta z-parameters z-ts"><span class="z-punctuation z-definition z-parameters z-begin z-ts">(</span><span class="z-variable z-parameter z-ts">err</span><span class="z-punctuation z-separator z-parameter z-ts">,</span> <span class="z-variable z-parameter z-ts">contents</span><span class="z-punctuation z-definition z-parameters z-end z-ts">)</span></span> <span class="z-meta z-block z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span>
      <span class="z-keyword z-control z-conditional z-ts">if</span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-variable z-other z-readwrite z-ts">err</span><span class="z-meta z-brace z-round z-ts">)</span> <span class="z-keyword z-control z-trycatch z-ts">throw</span> <span class="z-variable z-other z-readwrite z-ts">err</span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
      <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">httpPost</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-variable z-other z-readwrite z-ts">contents</span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-meta z-function z-expression z-ts"><span class="z-storage z-type z-function z-ts">function</span><span class="z-meta z-parameters z-ts"><span class="z-punctuation z-definition z-parameters z-begin z-ts">(</span><span class="z-variable z-parameter z-ts">err</span><span class="z-punctuation z-separator z-parameter z-ts">,</span> <span class="z-variable z-parameter z-ts">json</span><span class="z-punctuation z-definition z-parameters z-end z-ts">)</span></span> <span class="z-meta z-block z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span>
        <span class="z-keyword z-control z-conditional z-ts">if</span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-variable z-other z-readwrite z-ts">err</span><span class="z-meta z-brace z-round z-ts">)</span> <span class="z-keyword z-control z-trycatch z-ts">throw</span> <span class="z-variable z-other z-readwrite z-ts">err</span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
        <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">callback</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-variable z-other z-readwrite z-ts">json</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
      <span class="z-punctuation z-definition z-block z-ts">}</span></span></span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
    <span class="z-punctuation z-definition z-block z-ts">}</span></span></span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
  <span class="z-punctuation z-definition z-block z-ts">}</span></span>
<span class="z-punctuation z-definition z-block z-ts">}</span></span></span></span>
</span></code></pre><p>çœ‹çœ‹ï¼Œè¿™ç®€ç›´å°±æ˜¯é­”é¬¼çš„ç®—æœ¯ï¼ˆè¯‘è€…æ³¨ï¼šæ­¤å¤„åŸæ–‡æ˜¯â€œthe devil's arithmeticâ€ï¼Œä¸ºç¾å›½ 1988 å¹´å‡ºç‰ˆçš„å†å²å°è¯´ï¼Œè®²è¿°ä¸€ä¸ªçŠ¹å¤ªå°å¥³å­©ç©¿è¶Šåˆ° 1942 å¹´çš„é›†ä¸­è¥çš„æ•…äº‹ã€‚æ­¤ä¹¦äº¦æœ‰åŒåæ”¹ç¼–ç”µå½±ï¼Œä¸­è¯‘åã€Šç©¿æ¢­é›†ä¸­è¥ã€‹ï¼‰ï¼Œæˆ‘ä»¬å°±åƒä¸€é¢—å¼¹ç ä¸€æ ·åœ¨å˜å¹»è«æµ‹çš„è¿·å®«ä¸­ç©¿æ¢­ã€‚æ— æ³•æƒ³è±¡å¦‚æœè¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„åº”ç”¨ï¼Œè€Œä¸”ä¸€ç›´åœ¨æ”¹å˜å˜é‡ä¼šæ€æ ·â€”â€”æˆ‘ä»¬è‚¯å®šä¼šåƒé™·å…¥æ²¥é’å‘é‚£æ ·æ— æ‰€é€‚ä»ã€‚<h1 id=li-lun>ç†è®º<a aria-label="Anchor link for: li-lun" class=zola-anchor href=#li-lun style=visibility:hidden>#</a></h1><p>æˆ‘ä»¬è¦çœ‹çš„ç¬¬ä¸€æ¡å®šå¾‹æ˜¯ç»“åˆå¾‹ï¼Œä½†å¯èƒ½ä¸æ˜¯ä½ ç†Ÿæ‚‰çš„é‚£ä¸ªç»“åˆå¾‹ã€‚<pre class="language-js z-code" data-lang=js><code class=language-js data-lang=js><span class="z-source z-ts"><span class="z-punctuation z-whitespace z-comment z-leading z-ts">  </span><span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts"> ç»“åˆå¾‹</span>
  <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">compose</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-variable z-other z-readwrite z-ts">join</span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">map</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-variable z-other z-readwrite z-ts">join</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-meta z-brace z-round z-ts">)</span> <span class="z-keyword z-operator z-comparison z-ts">==</span> <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">compose</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-variable z-other z-readwrite z-ts">join</span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-variable z-other z-readwrite z-ts">join</span><span class="z-meta z-brace z-round z-ts">)</span>
</span></code></pre><p>è¿™äº›å®šå¾‹è¡¨æ˜äº† monad çš„åµŒå¥—æœ¬è´¨ï¼Œæ‰€ä»¥ç»“åˆå¾‹å…³å¿ƒçš„æ˜¯å¦‚ä½•è®©å†…å±‚æˆ–å¤–å±‚çš„å®¹å™¨ç±»å‹ <code>join</code>ï¼Œç„¶åå–å¾—åŒæ ·çš„ç»“æœã€‚ç”¨ä¸€å¼ å›¾æ¥è¡¨ç¤ºå¯èƒ½æ•ˆæœä¼šæ›´å¥½ï¼š<figure><img alt="monad associativity law" src=https://shankun.github.io/img/monad_associativity.png></figure><p>ä»å·¦ä¸Šè§’å¾€ä¸‹ï¼Œå…ˆç”¨ <code>join</code> åˆå¹¶ <code>M(M(M a))</code> æœ€å¤–å±‚çš„ä¸¤ä¸ª <code>M</code>ï¼Œç„¶åå¾€å³ï¼Œå†è°ƒç”¨ä¸€æ¬¡ <code>join</code>ï¼Œå°±å¾—åˆ°äº†æˆ‘ä»¬æƒ³è¦çš„ <code>M a</code>ã€‚æˆ–è€…ï¼Œä»å·¦ä¸Šè§’å¾€å³ï¼Œå…ˆæ‰“å¼€æœ€å¤–å±‚çš„ <code>M</code>ï¼Œç”¨ <code>map(join)</code> åˆå¹¶å†…å±‚çš„ä¸¤ä¸ª <code>M</code>ï¼Œç„¶åå†å‘ä¸‹è°ƒç”¨ä¸€æ¬¡ <code>join</code>ï¼Œä¹Ÿèƒ½å¾—åˆ° <code>M a</code>ã€‚ä¸ç®¡æ˜¯å…ˆåˆå¹¶å†…å±‚è¿˜æ˜¯å…ˆåˆå¹¶å¤–å±‚çš„ <code>M</code>ï¼Œæœ€åéƒ½ä¼šå¾—åˆ°ç›¸åŒçš„ <code>M a</code>ï¼Œæ‰€ä»¥è¿™å°±æ˜¯ç»“åˆå¾‹ã€‚å€¼å¾—æ³¨æ„çš„ä¸€ç‚¹æ˜¯ <code>map(join) != join</code>ã€‚ä¸¤ç§æ–¹å¼çš„ä¸­é—´æ­¥éª¤å¯èƒ½ä¼šæœ‰ä¸åŒçš„å€¼ï¼Œä½†æœ€åä¸€ä¸ª <code>join</code> è°ƒç”¨åæœ€ç»ˆç»“æœæ˜¯ä¸€æ ·çš„ã€‚<p>ç¬¬äºŒä¸ªå®šå¾‹ä¸ç»“åˆå¾‹ç±»ä¼¼ï¼š<pre class="language-js z-code" data-lang=js><code class=language-js data-lang=js><span class="z-source z-ts"><span class="z-punctuation z-whitespace z-comment z-leading z-ts">  </span><span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts"> åŒä¸€å¾‹ (M a)</span>
  <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">compose</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-variable z-other z-readwrite z-ts">join</span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-keyword z-operator z-expression z-of z-ts">of</span><span class="z-meta z-brace z-round z-ts">)</span> <span class="z-keyword z-operator z-comparison z-ts">==</span> <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">compose</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-variable z-other z-readwrite z-ts">join</span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">map</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-keyword z-operator z-expression z-of z-ts">of</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-meta z-brace z-round z-ts">)</span> <span class="z-keyword z-operator z-comparison z-ts">==</span> <span class="z-variable z-other z-readwrite z-ts">id</span>
</span></code></pre><p>è¿™è¡¨æ˜ï¼Œå¯¹ä»»æ„çš„ monad <code>M</code>ï¼Œ<code>of</code> å’Œ <code>join</code> ç›¸å½“äº <code>id</code>ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>map(of)</code> ç”±å†…è€Œå¤–å®ç°ç›¸åŒæ•ˆæœã€‚æˆ‘ä»¬æŠŠè¿™ä¸ªå®šå¾‹å«åšâ€œä¸‰è§’åŒä¸€å¾‹â€ï¼ˆtriangle identityï¼‰ï¼Œå› ä¸ºæŠŠå®ƒå›¾å½¢åŒ–ä¹‹åå°±åƒä¸€ä¸ªä¸‰è§’å½¢ï¼š<figure><img alt="monad identity law" src=https://shankun.github.io/img/triangle_identity.png></figure><p>å¦‚æœä»å·¦ä¸Šè§’å¼€å§‹å¾€å³ï¼Œå¯ä»¥çœ‹åˆ° <code>of</code> çš„ç¡®æŠŠ <code>M a</code> ä¸¢åˆ°å¦ä¸€ä¸ª <code>M</code> å®¹å™¨é‡Œå»äº†ã€‚ç„¶åå†å¾€ä¸‹ <code>join</code>ï¼Œå°±å¾—åˆ°äº† <code>M a</code>ï¼Œè·Ÿä¸€å¼€å§‹å°±è°ƒç”¨ <code>id</code> çš„ç»“æœä¸€æ ·ã€‚ä»å³ä¸Šè§’å¾€å·¦ï¼Œå¯ä»¥çœ‹åˆ°å¦‚æœæˆ‘ä»¬é€šè¿‡ <code>map</code> è¿›åˆ°äº† <code>M</code> é‡Œé¢ï¼Œç„¶åå¯¹æ™®é€šå€¼ <code>a</code> è°ƒç”¨ <code>of</code>ï¼Œæœ€åå¾—åˆ°çš„è¿˜æ˜¯ <code>M (M a)</code>ï¼›å†è°ƒç”¨ä¸€æ¬¡ <code>join</code> å°†ä¼šæŠŠæˆ‘ä»¬å¸¦å›åŸç‚¹ï¼Œå³ <code>M a</code>ã€‚<p>æˆ‘è¦è¯´æ˜ä¸€ç‚¹ï¼Œå°½ç®¡è¿™é‡Œæˆ‘å†™çš„æ˜¯ <code>of</code>ï¼Œå®é™…ä¸Šå¯¹ä»»æ„çš„ monad è€Œè¨€ï¼Œéƒ½å¿…é¡»è¦ä½¿ç”¨æ˜ç¡®çš„ <code>M.of</code>ã€‚<p>æˆ‘å·²ç»è§è¿‡è¿™äº›å®šå¾‹äº†ï¼ŒåŒä¸€å¾‹å’Œç»“åˆå¾‹ï¼Œä»¥å‰å°±åœ¨å“ªå„¿è§è¿‡...ç­‰ä¸€ä¸‹ï¼Œè®©æˆ‘æƒ³æƒ³...æ˜¯çš„ï¼å®ƒä»¬æ˜¯èŒƒç•´éµå¾ªçš„å®šå¾‹ï¼ä¸è¿‡è¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦ä¸€ä¸ªç»„åˆå‡½æ•°æ¥ç»™å‡ºä¸€ä¸ªå®Œæ•´å®šä¹‰ã€‚è§è¯å§ï¼š<pre class="language-js z-code" data-lang=js><code class=language-js data-lang=js><span class="z-source z-ts">  <span class="z-meta z-var z-expr z-ts"><span class="z-storage z-type z-ts">var</span> <span class="z-meta z-var-single-variable z-expr z-ts"><span class="z-meta z-definition z-variable z-ts"><span class="z-entity z-name z-function z-ts">mcompose</span></span> </span><span class="z-keyword z-operator z-assignment z-ts">=</span> <span class="z-meta z-function z-expression z-ts"><span class="z-storage z-type z-function z-ts">function</span><span class="z-meta z-parameters z-ts"><span class="z-punctuation z-definition z-parameters z-begin z-ts">(</span><span class="z-variable z-parameter z-ts">f</span><span class="z-punctuation z-separator z-parameter z-ts">,</span> <span class="z-variable z-parameter z-ts">g</span><span class="z-punctuation z-definition z-parameters z-end z-ts">)</span></span> <span class="z-meta z-block z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span>
    <span class="z-keyword z-control z-flow z-ts">return</span> <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">compose</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">chain</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-variable z-other z-readwrite z-ts">f</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">chain</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-variable z-other z-readwrite z-ts">g</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
  <span class="z-punctuation z-definition z-block z-ts">}</span></span></span></span>

<span class="z-punctuation z-whitespace z-comment z-leading z-ts">  </span><span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts"> å·¦åŒä¸€å¾‹</span>
  <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">mcompose</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-variable z-other z-constant z-ts">M</span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-variable z-other z-readwrite z-ts">f</span><span class="z-meta z-brace z-round z-ts">)</span> <span class="z-keyword z-operator z-comparison z-ts">==</span> <span class="z-variable z-other z-readwrite z-ts">f</span>

<span class="z-punctuation z-whitespace z-comment z-leading z-ts">  </span><span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts"> å³åŒä¸€å¾‹</span>
  <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">mcompose</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-variable z-other z-readwrite z-ts">f</span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-variable z-other z-constant z-ts">M</span><span class="z-meta z-brace z-round z-ts">)</span> <span class="z-keyword z-operator z-comparison z-ts">==</span> <span class="z-variable z-other z-readwrite z-ts">f</span>

<span class="z-punctuation z-whitespace z-comment z-leading z-ts">  </span><span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts"> ç»“åˆå¾‹</span>
  <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">mcompose</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">mcompose</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-variable z-other z-readwrite z-ts">f</span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-variable z-other z-readwrite z-ts">g</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-variable z-other z-readwrite z-ts">h</span><span class="z-meta z-brace z-round z-ts">)</span> <span class="z-keyword z-operator z-comparison z-ts">==</span> <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">mcompose</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-variable z-other z-readwrite z-ts">f</span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">mcompose</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-variable z-other z-readwrite z-ts">g</span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-variable z-other z-readwrite z-ts">h</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-meta z-brace z-round z-ts">)</span>
</span></code></pre><p>æ¯•ç«Ÿå®ƒä»¬æ˜¯èŒƒç•´å­¦é‡Œçš„å®šå¾‹ã€‚monad æ¥è‡ªäºä¸€ä¸ªå« â€œKleisli èŒƒç•´â€çš„èŒƒç•´ï¼Œè¿™ä¸ªèŒƒç•´é‡Œè¾¹æ‰€æœ‰çš„å¯¹è±¡éƒ½æ˜¯ monadï¼Œæ‰€æœ‰çš„æ€å°„éƒ½æ˜¯è”ç»“å‡½æ•°ï¼ˆchained funtionsï¼‰ã€‚æˆ‘ä¸æ˜¯è¦åœ¨æ²¡æœ‰æä¾›å¤ªå¤šè§£é‡Šçš„æƒ…å†µä¸‹ï¼Œæ‹¿èŒƒç•´å­¦é‡Œå„å¼å„æ ·çš„æ¦‚å¿µæ¥å–ç¬‘ä½ ã€‚æˆ‘çš„ç›®çš„æ˜¯æ¶‰åŠè¶³å¤Ÿå¤šçš„è¡¨é¢çŸ¥è¯†ï¼Œå‘ä½ è¯´æ˜è¿™ä¸­é—´çš„ç›¸å…³æ€§ï¼Œè®©ä½ åœ¨å…³æ³¨æ—¥å¸¸å®ç”¨ç‰¹æ€§ä¹‹ä½™ï¼Œæ¿€å‘èµ·å¯¹è¿™äº›å®šå¾‹çš„å…´è¶£ã€‚<h2 id=zong-jie>æ€»ç»“<a aria-label="Anchor link for: zong-jie" class=zola-anchor href=#zong-jie style=visibility:hidden>#</a></h2><p>monad è®©æˆ‘ä»¬æ·±å…¥åˆ°åµŒå¥—çš„è¿ç®—å½“ä¸­ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿåœ¨å®Œå…¨é¿å…å›è°ƒé‡‘å­—å¡”ï¼ˆpyramid of doomï¼‰æƒ…å†µä¸‹ï¼Œä¸ºå˜é‡èµ‹å€¼ï¼Œè¿è¡Œæœ‰åºçš„ä½œç”¨ï¼Œæ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ç­‰ç­‰ã€‚å½“ä¸€ä¸ªå€¼è¢«å›°åœ¨å‡ å±‚ç›¸åŒç±»å‹çš„å®¹å™¨ä¸­æ—¶ï¼Œmonad èƒ½å¤Ÿæ‹¯æ•‘å®ƒã€‚å€ŸåŠ© â€œpointedâ€ è¿™ä¸ªå¯é çš„å¸®æ‰‹ï¼Œmonad èƒ½å¤Ÿå€Ÿç»™æˆ‘ä»¬ä»ç›’å­ä¸­å–å‡ºçš„å€¼ï¼Œè€Œä¸”çŸ¥é“æˆ‘ä»¬ä¼šåœ¨ç»“æŸä½¿ç”¨åè¿˜ç»™å®ƒã€‚<p>æ˜¯çš„ï¼Œmonad éå¸¸å¼ºå¤§ï¼Œä½†æˆ‘ä»¬è¿˜éœ€è¦ä¸€äº›é¢å¤–çš„å®¹å™¨å‡½æ•°ã€‚æ¯”å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æƒ³åŒæ—¶è¿è¡Œä¸€ä¸ªåˆ—è¡¨é‡Œçš„ api è°ƒç”¨ï¼Œç„¶åå†æœé›†è¿”å›çš„ç»“æœï¼Œæ€ä¹ˆåŠï¼Ÿæ˜¯å¯ä»¥ä½¿ç”¨ monad å®ç°è¿™ä¸ªä»»åŠ¡ï¼Œä½†å¿…é¡»è¦ç­‰æ¯ä¸€ä¸ª api å®Œæˆåæ‰èƒ½è°ƒç”¨ä¸‹ä¸€ä¸ªã€‚åˆå¹¶å¤šä¸ªåˆæ³•æ€§éªŒè¯å‘¢ï¼Ÿæˆ‘ä»¬æƒ³è¦çš„è‚¯å®šæ˜¯æŒç»­éªŒè¯ä»¥æœé›†é”™è¯¯åˆ—è¡¨ï¼Œä½†æ˜¯ monad ä¼šåœ¨ç¬¬ä¸€ä¸ª <code>Left</code> ç™»åœºçš„æ—¶å€™åœæ‰æ•´ä¸ªæ¼”å‡ºã€‚<p>ä¸‹ä¸€ç« ï¼Œæˆ‘ä»¬å°†çœ‹åˆ° applicative functor å¦‚ä½•èå…¥è¿™ä¸ªå®¹å™¨ä¸–ç•Œï¼Œä»¥åŠä¸ºä½•åœ¨å¾ˆå¤šæƒ…å†µä¸‹å®ƒæ¯” monad æ›´å¥½ç”¨ã€‚<p><a href=../mostly-adequate-guide-ch10/>ç¬¬ 10 ç« : Applicative Functor</a><h2 id=lian-xi>ç»ƒä¹ <a aria-label="Anchor link for: lian-xi" class=zola-anchor href=#lian-xi style=visibility:hidden>#</a></h2><pre class="language-js z-code" data-lang=js><code class=language-js data-lang=js><span class="z-source z-ts"><span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts"> ç»ƒä¹  1</span>
<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts"> ==========</span>
<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts"> ç»™å®šä¸€ä¸ª userï¼Œä½¿ç”¨ safeProp å’Œ map/join æˆ– chain å®‰å…¨åœ°è·å– sreet çš„ name</span>

<span class="z-meta z-var z-expr z-ts"><span class="z-storage z-type z-ts">var</span> <span class="z-meta z-var-single-variable z-expr z-ts"><span class="z-meta z-definition z-variable z-ts"><span class="z-variable z-other z-readwrite z-ts">safeProp</span></span> </span><span class="z-keyword z-operator z-assignment z-ts">=</span> <span class="z-meta z-function-call z-ts"><span class="z-variable z-other z-object z-ts">_</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-entity z-name z-function z-ts">curry</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-function z-expression z-ts"><span class="z-storage z-type z-function z-ts">function</span> <span class="z-meta z-parameters z-ts"><span class="z-punctuation z-definition z-parameters z-begin z-ts">(</span><span class="z-variable z-parameter z-ts">x</span><span class="z-punctuation z-separator z-parameter z-ts">,</span> <span class="z-variable z-parameter z-ts">o</span><span class="z-punctuation z-definition z-parameters z-end z-ts">)</span></span> <span class="z-meta z-block z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span> <span class="z-keyword z-control z-flow z-ts">return</span> <span class="z-meta z-function-call z-ts"><span class="z-variable z-other z-object z-ts">Maybe</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-entity z-name z-function z-ts">of</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-variable z-other z-readwrite z-ts">o</span><span class="z-meta z-array z-literal z-ts"><span class="z-meta z-brace z-square z-ts">[</span><span class="z-variable z-other z-readwrite z-ts">x</span><span class="z-meta z-brace z-square z-ts">]</span></span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-terminator z-statement z-ts">;</span> <span class="z-punctuation z-definition z-block z-ts">}</span></span></span><span class="z-meta z-brace z-round z-ts">)</span></span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
<span class="z-meta z-var z-expr z-ts"><span class="z-storage z-type z-ts">var</span> <span class="z-meta z-var-single-variable z-expr z-ts"><span class="z-meta z-definition z-variable z-ts"><span class="z-variable z-other z-readwrite z-ts">user</span></span> </span><span class="z-keyword z-operator z-assignment z-ts">=</span> <span class="z-meta z-objectliteral z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span>
  <span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts">id</span></span><span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts"><span class="z-punctuation z-separator z-key-value z-ts">:</span></span> <span class="z-constant z-numeric z-decimal z-ts">2</span></span><span class="z-punctuation z-separator z-comma z-ts">,</span>
  <span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts">name</span></span><span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts"><span class="z-punctuation z-separator z-key-value z-ts">:</span></span> <span class="z-string z-quoted z-double z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">"</span>albert<span class="z-punctuation z-definition z-string z-end z-ts">"</span></span></span><span class="z-punctuation z-separator z-comma z-ts">,</span>
  <span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts">address</span></span><span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts"><span class="z-punctuation z-separator z-key-value z-ts">:</span></span> <span class="z-meta z-objectliteral z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span>
    <span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts">street</span></span><span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts"><span class="z-punctuation z-separator z-key-value z-ts">:</span></span> <span class="z-meta z-objectliteral z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span>
      <span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts">number</span></span><span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts"><span class="z-punctuation z-separator z-key-value z-ts">:</span></span> <span class="z-constant z-numeric z-decimal z-ts">22</span></span><span class="z-punctuation z-separator z-comma z-ts">,</span>
      <span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts">name</span></span><span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts"><span class="z-punctuation z-separator z-key-value z-ts">:</span></span> <span class="z-string z-quoted z-single z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">'</span>Walnut St<span class="z-punctuation z-definition z-string z-end z-ts">'</span></span>
    </span><span class="z-punctuation z-definition z-block z-ts">}</span></span>
  </span><span class="z-punctuation z-definition z-block z-ts">}</span></span>
</span><span class="z-punctuation z-definition z-block z-ts">}</span></span></span><span class="z-punctuation z-terminator z-statement z-ts">;</span>

<span class="z-meta z-var z-expr z-ts"><span class="z-storage z-type z-ts">var</span> <span class="z-meta z-var-single-variable z-expr z-ts"><span class="z-meta z-definition z-variable z-ts"><span class="z-variable z-other z-readwrite z-ts">ex1</span></span> </span><span class="z-keyword z-operator z-assignment z-ts">=</span> <span class="z-constant z-language z-undefined z-ts">undefined</span></span><span class="z-punctuation z-terminator z-statement z-ts">;</span>


<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts"> ç»ƒä¹  2</span>
<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts"> ==========</span>
<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts"> ä½¿ç”¨ getFile è·å–æ–‡ä»¶åå¹¶åˆ é™¤ç›®å½•ï¼Œæ‰€ä»¥è¿”å›å€¼ä»…ä»…æ˜¯æ–‡ä»¶ï¼Œç„¶åä»¥çº¯çš„æ–¹å¼æ‰“å°æ–‡ä»¶</span>

<span class="z-meta z-var z-expr z-ts"><span class="z-storage z-type z-ts">var</span> <span class="z-meta z-var-single-variable z-expr z-ts"><span class="z-meta z-definition z-variable z-ts"><span class="z-entity z-name z-function z-ts">getFile</span></span> </span><span class="z-keyword z-operator z-assignment z-ts">=</span> <span class="z-meta z-function z-expression z-ts"><span class="z-storage z-type z-function z-ts">function</span><span class="z-meta z-parameters z-ts"><span class="z-punctuation z-definition z-parameters z-begin z-ts">(</span><span class="z-punctuation z-definition z-parameters z-end z-ts">)</span></span> <span class="z-meta z-block z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span>
  <span class="z-keyword z-control z-flow z-ts">return</span> <span class="z-new z-expr z-ts"><span class="z-keyword z-operator z-new z-ts">new</span> <span class="z-entity z-name z-type z-ts">IO</span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-function z-expression z-ts"><span class="z-storage z-type z-function z-ts">function</span><span class="z-meta z-parameters z-ts"><span class="z-punctuation z-definition z-parameters z-begin z-ts">(</span><span class="z-punctuation z-definition z-parameters z-end z-ts">)</span></span><span class="z-meta z-block z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span> <span class="z-keyword z-control z-flow z-ts">return</span> <span class="z-support z-variable z-object z-node z-ts">__filename</span><span class="z-punctuation z-terminator z-statement z-ts">;</span> <span class="z-punctuation z-definition z-block z-ts">}</span></span></span><span class="z-meta z-brace z-round z-ts">)</span></span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
<span class="z-punctuation z-definition z-block z-ts">}</span></span></span></span>

<span class="z-meta z-var z-expr z-ts"><span class="z-storage z-type z-ts">var</span> <span class="z-meta z-var-single-variable z-expr z-ts"><span class="z-meta z-definition z-variable z-ts"><span class="z-entity z-name z-function z-ts">pureLog</span></span> </span><span class="z-keyword z-operator z-assignment z-ts">=</span> <span class="z-meta z-function z-expression z-ts"><span class="z-storage z-type z-function z-ts">function</span><span class="z-meta z-parameters z-ts"><span class="z-punctuation z-definition z-parameters z-begin z-ts">(</span><span class="z-variable z-parameter z-ts">x</span><span class="z-punctuation z-definition z-parameters z-end z-ts">)</span></span> <span class="z-meta z-block z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span>
  <span class="z-keyword z-control z-flow z-ts">return</span> <span class="z-new z-expr z-ts"><span class="z-keyword z-operator z-new z-ts">new</span> <span class="z-entity z-name z-type z-ts">IO</span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-function z-expression z-ts"><span class="z-storage z-type z-function z-ts">function</span><span class="z-meta z-parameters z-ts"><span class="z-punctuation z-definition z-parameters z-begin z-ts">(</span><span class="z-punctuation z-definition z-parameters z-end z-ts">)</span></span><span class="z-meta z-block z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span>
    <span class="z-meta z-function-call z-ts"><span class="z-support z-class z-console z-ts">console</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-support z-function z-console z-ts">log</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-variable z-other z-readwrite z-ts">x</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
    <span class="z-keyword z-control z-flow z-ts">return</span> <span class="z-string z-quoted z-single z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">'</span>logged <span class="z-punctuation z-definition z-string z-end z-ts">'</span></span> <span class="z-keyword z-operator z-arithmetic z-ts">+</span> <span class="z-variable z-other z-readwrite z-ts">x</span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
  <span class="z-punctuation z-definition z-block z-ts">}</span></span></span><span class="z-meta z-brace z-round z-ts">)</span></span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
<span class="z-punctuation z-definition z-block z-ts">}</span></span></span></span>

<span class="z-meta z-var z-expr z-ts"><span class="z-storage z-type z-ts">var</span> <span class="z-meta z-var-single-variable z-expr z-ts"><span class="z-meta z-definition z-variable z-ts"><span class="z-variable z-other z-readwrite z-ts">ex2</span></span> </span><span class="z-keyword z-operator z-assignment z-ts">=</span> <span class="z-constant z-language z-undefined z-ts">undefined</span></span><span class="z-punctuation z-terminator z-statement z-ts">;</span>



<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts"> ç»ƒä¹  3</span>
<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts"> ==========</span>
<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts"> ä½¿ç”¨ getPost() ç„¶åä»¥ post çš„ id è°ƒç”¨ getComments()</span>
<span class="z-meta z-var z-expr z-ts"><span class="z-storage z-type z-ts">var</span> <span class="z-meta z-var-single-variable z-expr z-ts"><span class="z-meta z-definition z-variable z-ts"><span class="z-entity z-name z-function z-ts">getPost</span></span> </span><span class="z-keyword z-operator z-assignment z-ts">=</span> <span class="z-meta z-function z-expression z-ts"><span class="z-storage z-type z-function z-ts">function</span><span class="z-meta z-parameters z-ts"><span class="z-punctuation z-definition z-parameters z-begin z-ts">(</span><span class="z-variable z-parameter z-ts">i</span><span class="z-punctuation z-definition z-parameters z-end z-ts">)</span></span> <span class="z-meta z-block z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span>
  <span class="z-keyword z-control z-flow z-ts">return</span> <span class="z-new z-expr z-ts"><span class="z-keyword z-operator z-new z-ts">new</span> <span class="z-entity z-name z-type z-ts">Task</span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-function z-expression z-ts"><span class="z-storage z-type z-function z-ts">function</span> <span class="z-meta z-parameters z-ts"><span class="z-punctuation z-definition z-parameters z-begin z-ts">(</span><span class="z-variable z-parameter z-ts">rej</span><span class="z-punctuation z-separator z-parameter z-ts">,</span> <span class="z-variable z-parameter z-ts">res</span><span class="z-punctuation z-definition z-parameters z-end z-ts">)</span></span> <span class="z-meta z-block z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span>
    <span class="z-meta z-function-call z-ts"><span class="z-support z-function z-ts">setTimeout</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-function z-expression z-ts"><span class="z-storage z-type z-function z-ts">function</span> <span class="z-meta z-parameters z-ts"><span class="z-punctuation z-definition z-parameters z-begin z-ts">(</span><span class="z-punctuation z-definition z-parameters z-end z-ts">)</span></span> <span class="z-meta z-block z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span>
      <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">res</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-objectliteral z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span> <span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts">id</span></span><span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts"><span class="z-punctuation z-separator z-key-value z-ts">:</span></span> <span class="z-variable z-other z-readwrite z-ts">i</span></span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts">title</span></span><span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts"><span class="z-punctuation z-separator z-key-value z-ts">:</span></span> <span class="z-string z-quoted z-single z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">'</span>Love them tasks<span class="z-punctuation z-definition z-string z-end z-ts">'</span></span> </span><span class="z-punctuation z-definition z-block z-ts">}</span></span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
    <span class="z-punctuation z-definition z-block z-ts">}</span></span></span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-constant z-numeric z-decimal z-ts">300</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
  <span class="z-punctuation z-definition z-block z-ts">}</span></span></span><span class="z-meta z-brace z-round z-ts">)</span></span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
<span class="z-punctuation z-definition z-block z-ts">}</span></span></span></span>

<span class="z-meta z-var z-expr z-ts"><span class="z-storage z-type z-ts">var</span> <span class="z-meta z-var-single-variable z-expr z-ts"><span class="z-meta z-definition z-variable z-ts"><span class="z-entity z-name z-function z-ts">getComments</span></span> </span><span class="z-keyword z-operator z-assignment z-ts">=</span> <span class="z-meta z-function z-expression z-ts"><span class="z-storage z-type z-function z-ts">function</span><span class="z-meta z-parameters z-ts"><span class="z-punctuation z-definition z-parameters z-begin z-ts">(</span><span class="z-variable z-parameter z-ts">i</span><span class="z-punctuation z-definition z-parameters z-end z-ts">)</span></span> <span class="z-meta z-block z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span>
  <span class="z-keyword z-control z-flow z-ts">return</span> <span class="z-new z-expr z-ts"><span class="z-keyword z-operator z-new z-ts">new</span> <span class="z-entity z-name z-type z-ts">Task</span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-function z-expression z-ts"><span class="z-storage z-type z-function z-ts">function</span> <span class="z-meta z-parameters z-ts"><span class="z-punctuation z-definition z-parameters z-begin z-ts">(</span><span class="z-variable z-parameter z-ts">rej</span><span class="z-punctuation z-separator z-parameter z-ts">,</span> <span class="z-variable z-parameter z-ts">res</span><span class="z-punctuation z-definition z-parameters z-end z-ts">)</span></span> <span class="z-meta z-block z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span>
    <span class="z-meta z-function-call z-ts"><span class="z-support z-function z-ts">setTimeout</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-function z-expression z-ts"><span class="z-storage z-type z-function z-ts">function</span> <span class="z-meta z-parameters z-ts"><span class="z-punctuation z-definition z-parameters z-begin z-ts">(</span><span class="z-punctuation z-definition z-parameters z-end z-ts">)</span></span> <span class="z-meta z-block z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span>
      <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">res</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-array z-literal z-ts"><span class="z-meta z-brace z-square z-ts">[</span>
        <span class="z-meta z-objectliteral z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span><span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts">post_id</span></span><span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts"><span class="z-punctuation z-separator z-key-value z-ts">:</span></span> <span class="z-variable z-other z-readwrite z-ts">i</span></span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts">body</span></span><span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts"><span class="z-punctuation z-separator z-key-value z-ts">:</span></span> <span class="z-string z-quoted z-double z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">"</span>This book should be illegal<span class="z-punctuation z-definition z-string z-end z-ts">"</span></span></span><span class="z-punctuation z-definition z-block z-ts">}</span></span><span class="z-punctuation z-separator z-comma z-ts">,</span>
        <span class="z-meta z-objectliteral z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span><span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts">post_id</span></span><span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts"><span class="z-punctuation z-separator z-key-value z-ts">:</span></span> <span class="z-variable z-other z-readwrite z-ts">i</span></span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts">body</span></span><span class="z-meta z-object z-member z-ts"><span class="z-meta z-object-literal z-key z-ts"><span class="z-punctuation z-separator z-key-value z-ts">:</span></span> <span class="z-string z-quoted z-double z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">"</span>Monads are like smelly shallots<span class="z-punctuation z-definition z-string z-end z-ts">"</span></span></span><span class="z-punctuation z-definition z-block z-ts">}</span></span>
      <span class="z-meta z-brace z-square z-ts">]</span></span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
    <span class="z-punctuation z-definition z-block z-ts">}</span></span></span><span class="z-punctuation z-separator z-comma z-ts">,</span> <span class="z-constant z-numeric z-decimal z-ts">300</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
  <span class="z-punctuation z-definition z-block z-ts">}</span></span></span><span class="z-meta z-brace z-round z-ts">)</span></span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
<span class="z-punctuation z-definition z-block z-ts">}</span></span></span></span>


<span class="z-meta z-var z-expr z-ts"><span class="z-storage z-type z-ts">var</span> <span class="z-meta z-var-single-variable z-expr z-ts"><span class="z-meta z-definition z-variable z-ts"><span class="z-variable z-other z-readwrite z-ts">ex3</span></span> </span><span class="z-keyword z-operator z-assignment z-ts">=</span> <span class="z-constant z-language z-undefined z-ts">undefined</span></span><span class="z-punctuation z-terminator z-statement z-ts">;</span>


<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts"> ç»ƒä¹  4</span>
<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts"> ==========</span>
<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts"> ç”¨ validateEmailã€addToMailingList å’Œ emailBlast å®ç° ex4 çš„ç±»å‹ç­¾å</span>

<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts">  addToMailingList :: Email -> IO([Email])</span>
<span class="z-meta z-var z-expr z-ts"><span class="z-storage z-type z-ts">var</span> <span class="z-meta z-var-single-variable z-expr z-ts"><span class="z-meta z-definition z-variable z-ts"><span class="z-variable z-other z-readwrite z-ts">addToMailingList</span></span> </span><span class="z-keyword z-operator z-assignment z-ts">=</span> <span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-function z-expression z-ts"><span class="z-storage z-type z-function z-ts">function</span><span class="z-meta z-parameters z-ts"><span class="z-punctuation z-definition z-parameters z-begin z-ts">(</span><span class="z-variable z-parameter z-ts">list</span><span class="z-punctuation z-definition z-parameters z-end z-ts">)</span></span><span class="z-meta z-block z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span>
  <span class="z-keyword z-control z-flow z-ts">return</span> <span class="z-meta z-function z-ts"><span class="z-storage z-type z-function z-ts">function</span><span class="z-meta z-parameters z-ts"><span class="z-punctuation z-definition z-parameters z-begin z-ts">(</span><span class="z-variable z-parameter z-ts">email</span><span class="z-punctuation z-definition z-parameters z-end z-ts">)</span></span> <span class="z-meta z-block z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span>
    <span class="z-keyword z-control z-flow z-ts">return</span> <span class="z-new z-expr z-ts"><span class="z-keyword z-operator z-new z-ts">new</span> <span class="z-entity z-name z-type z-ts">IO</span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-function z-expression z-ts"><span class="z-storage z-type z-function z-ts">function</span><span class="z-meta z-parameters z-ts"><span class="z-punctuation z-definition z-parameters z-begin z-ts">(</span><span class="z-punctuation z-definition z-parameters z-end z-ts">)</span></span><span class="z-meta z-block z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span>
      <span class="z-meta z-function-call z-ts"><span class="z-variable z-other z-object z-ts">list</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-support z-function z-ts">push</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-variable z-other z-readwrite z-ts">email</span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
      <span class="z-keyword z-control z-flow z-ts">return</span> <span class="z-variable z-other z-readwrite z-ts">list</span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
    <span class="z-punctuation z-definition z-block z-ts">}</span></span></span><span class="z-meta z-brace z-round z-ts">)</span></span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
  <span class="z-punctuation z-definition z-block z-ts">}</span></span></span>
<span class="z-punctuation z-definition z-block z-ts">}</span></span></span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-array z-literal z-ts"><span class="z-meta z-brace z-square z-ts">[</span><span class="z-meta z-brace z-square z-ts">]</span></span><span class="z-meta z-brace z-round z-ts">)</span></span><span class="z-punctuation z-terminator z-statement z-ts">;</span>

<span class="z-meta z-function z-ts"><span class="z-storage z-type z-function z-ts">function</span> <span class="z-meta z-definition z-function z-ts"><span class="z-entity z-name z-function z-ts">emailBlast</span></span><span class="z-meta z-parameters z-ts"><span class="z-punctuation z-definition z-parameters z-begin z-ts">(</span><span class="z-variable z-parameter z-ts">list</span><span class="z-punctuation z-definition z-parameters z-end z-ts">)</span></span> <span class="z-meta z-block z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span>
  <span class="z-keyword z-control z-flow z-ts">return</span> <span class="z-new z-expr z-ts"><span class="z-keyword z-operator z-new z-ts">new</span> <span class="z-entity z-name z-type z-ts">IO</span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-function z-expression z-ts"><span class="z-storage z-type z-function z-ts">function</span><span class="z-meta z-parameters z-ts"><span class="z-punctuation z-definition z-parameters z-begin z-ts">(</span><span class="z-punctuation z-definition z-parameters z-end z-ts">)</span></span><span class="z-meta z-block z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span>
    <span class="z-keyword z-control z-flow z-ts">return</span> <span class="z-string z-quoted z-single z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">'</span>emailed: <span class="z-punctuation z-definition z-string z-end z-ts">'</span></span> <span class="z-keyword z-operator z-arithmetic z-ts">+</span> <span class="z-meta z-function-call z-ts"><span class="z-variable z-other z-object z-ts">list</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-support z-function z-ts">join</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-string z-quoted z-single z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">'</span>,<span class="z-punctuation z-definition z-string z-end z-ts">'</span></span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
  <span class="z-punctuation z-definition z-block z-ts">}</span></span></span><span class="z-meta z-brace z-round z-ts">)</span></span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
<span class="z-punctuation z-definition z-block z-ts">}</span></span></span>

<span class="z-meta z-var z-expr z-ts"><span class="z-storage z-type z-ts">var</span> <span class="z-meta z-var-single-variable z-expr z-ts"><span class="z-meta z-definition z-variable z-ts"><span class="z-entity z-name z-function z-ts">validateEmail</span></span> </span><span class="z-keyword z-operator z-assignment z-ts">=</span> <span class="z-meta z-function z-expression z-ts"><span class="z-storage z-type z-function z-ts">function</span><span class="z-meta z-parameters z-ts"><span class="z-punctuation z-definition z-parameters z-begin z-ts">(</span><span class="z-variable z-parameter z-ts">x</span><span class="z-punctuation z-definition z-parameters z-end z-ts">)</span></span><span class="z-meta z-block z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span>
  <span class="z-keyword z-control z-flow z-ts">return</span> <span class="z-meta z-function-call z-ts"><span class="z-variable z-other z-object z-ts">x</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-support z-function z-ts">match</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-string z-regexp z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">/</span><span class="z-constant z-other z-character-class z-regexp">\S</span><span class="z-keyword z-operator z-quantifier z-regexp">+</span>@<span class="z-constant z-other z-character-class z-regexp">\S</span><span class="z-keyword z-operator z-quantifier z-regexp">+</span><span class="z-constant z-character z-escape z-backslash z-regexp">\.</span><span class="z-constant z-other z-character-class z-regexp">\S</span><span class="z-keyword z-operator z-quantifier z-regexp">+</span><span class="z-punctuation z-definition z-string z-end z-ts">/</span></span><span class="z-meta z-brace z-round z-ts">)</span> <span class="z-keyword z-operator z-ternary z-ts">?</span> <span class="z-meta z-brace z-round z-ts">(</span><span class="z-new z-expr z-ts"><span class="z-keyword z-operator z-new z-ts">new</span> <span class="z-entity z-name z-type z-ts">Right</span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-variable z-other z-readwrite z-ts">x</span><span class="z-meta z-brace z-round z-ts">)</span></span><span class="z-meta z-brace z-round z-ts">)</span> <span class="z-keyword z-operator z-ternary z-ts">:</span> <span class="z-meta z-brace z-round z-ts">(</span><span class="z-new z-expr z-ts"><span class="z-keyword z-operator z-new z-ts">new</span> <span class="z-entity z-name z-type z-ts">Left</span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-string z-quoted z-single z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">'</span>invalid email<span class="z-punctuation z-definition z-string z-end z-ts">'</span></span><span class="z-meta z-brace z-round z-ts">)</span></span><span class="z-meta z-brace z-round z-ts">)</span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
<span class="z-punctuation z-definition z-block z-ts">}</span></span></span></span>

<span class="z-comment z-line z-double-slash z-ts"><span class="z-punctuation z-definition z-comment z-ts">//</span></span><span class="z-comment z-line z-double-slash z-ts">  ex4 :: Email -> Either String (IO String)</span>
<span class="z-meta z-var z-expr z-ts"><span class="z-storage z-type z-ts">var</span> <span class="z-meta z-var-single-variable z-expr z-ts"><span class="z-meta z-definition z-variable z-ts"><span class="z-variable z-other z-readwrite z-ts">ex4</span></span> </span><span class="z-keyword z-operator z-assignment z-ts">=</span> <span class="z-constant z-language z-undefined z-ts">undefined</span></span><span class="z-punctuation z-terminator z-statement z-ts">;</span>
</span></code></pre></article><div class=giscus></div><script async crossorigin data-category=Announcements data-category-id=DIC_kwDOKg3Pks4CacrE data-emit-metadata=0 data-input-position=top data-lang=zh-CN data-loading=lazy data-mapping=pathname data-reactions-enabled=1 data-repo=shankun/shankun.github.io data-repo-id=R_kgDOKg3Pkg data-strict=0 data-theme=light src=https://giscus.app/client.js></script></div><footer><div class=copyright><p>Â© 2025 ShanKun</div><div class=credits>powered by <a rel="noreferrer noopener" href=https://www.getzola.org target=_blank>zola</a> and <a rel="noreferrer noopener" href=https://github.com/isunjn/serene target=_blank>serene</a></div></footer></main></div><script src=https://shankun.github.io/js/lightense.min.js></script><script src=https://shankun.github.io/js/main.js></script>